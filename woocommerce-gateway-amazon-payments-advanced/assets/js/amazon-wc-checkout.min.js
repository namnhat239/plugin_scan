!function(h){h(function(){var s=0,m="#pay_with_amazon",o="#classic_pay_with_amazon",_=null;h("form.checkout").on("checkout_place_order_success",function(e,a){return void 0!==a.amazonCreateCheckoutParams&&0<h(o).length&&(_=JSON.parse(a.amazonCreateCheckoutParams),i(o,"classic",_)),!0}),h("form#order_review").on("submit",function(e){if(!h(".wc-apa-widget-change").length&&"amazon_payments_advanced"===h("input[name=payment_method]:checked").val()){e.preventDefault();var a=new FormData(document.getElementById("order_review")),n=new URLSearchParams(window.location.search);a.append("amazon-classic-action","1"),a.append("key",n.get("key")),h.ajax({type:"post",data:a,processData:!1,contentType:!1,success:function(a){p(h("form#order_review"));try{if(!("success"===a.result&&void 0!==a.amazonCreateCheckoutParams&&0<h(o).length))throw"Result failure";_=JSON.parse(a.amazonCreateCheckoutParams),i(o,"classic",_)}catch(e){if(!0===a.reload)return void window.location.reload();!0===a.refresh&&h(document.body).trigger("update_checkout"),a.messages?r(h("form#order_review"),a.messages):r(h("form#order_review"),'<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>")}},error:function(e,a,n){p(h("form#order_review")),console.error(n)}})}return!0}),h(document.body).on("wc_fragments_loaded wc_fragments_refreshed",function(e){d("#pay_with_amazon_cart","cart")}),0<h("#pay_with_amazon_cart").length&&d("#pay_with_amazon_cart","cart");var t=h("#pay_with_amazon_product");if(0<t.length){var c=d("#pay_with_amazon_product","product");null!==c&&c.onClick(function(){var e=h(".single_add_to_cart_button");if(e.hasClass("disabled"))e.trigger("click");else{var a=0<t.closest("div.summary").length&&t.closest("div.summary");a&&u(a);var n=e.val()||0,o={action:amazon_payments_advanced.change_cart_action,_change_carts_nonce:amazon_payments_advanced.change_cart_ajax_nonce};h.each(e.closest("form.cart").serializeArray(),function(e,a){"add-to-cart"===a.name?o.product_id=a.value:o[a.name]=a.value}),o.quantity=o.quantity||1,o.variation_id=o.variation_id||0,o.product_id=o.product_id||n,h.ajax({url:amazon_payments_advanced.ajax_url,type:"get",data:h.param(o),success:function(e){e.data.create_checkout_session_config&&c.initCheckout({createCheckoutSessionConfig:e.data.create_checkout_session_config})},error:function(e,a,n){console.error(n)}}).always(function(){a&&p(a)})}})}function r(e,a){h(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),e.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+a+"</div>"),e.removeClass("processing").unblock()}function i(e,a,n){var o=d(e,a);null!==o&&o.initCheckout({createCheckoutSessionConfig:n})}function d(e,i){if(e=(e=e||m)instanceof h.Event?m:e,function(e){var a=h("cart"===e?"#wc-apa-update-vals-cart":"#wc-apa-update-vals");if(!a.length)return;var n=a.data("value");h.extend(amazon_payments_advanced,n),a.remove()}(i="string"!=typeof i?null:i),0!==h(e).length){s++;var d=null;return h(e).each(function(){var e=h(this),a=e.attr("id");if(m!=="#"+a||e.is(":visible")){void 0===a&&(a="pay_with_amazon_"+s,e.attr("id",a));var n=a;a="#"+a;var o=function(e){var a={merchantId:amazon_payments_advanced.merchant_id,ledgerCurrency:amazon_payments_advanced.ledger_currency,sandbox:"1"===amazon_payments_advanced.sandbox,placement:amazon_payments_advanced.placement,buttonColor:amazon_payments_advanced.button_color,checkoutLanguage:""!==amazon_payments_advanced.button_language?amazon_payments_advanced.button_language.replace("-","_"):void 0,productType:amazon_payments_advanced.action};"product"===e?a.productType=amazon_payments_advanced.product_action:"classic"===e&&null!==_?(a.productType=void 0!==_.payloadJSON.addressDetails?"PayAndShip":"PayOnly",_.payloadJSON=JSON.stringify(_.payloadJSON)):a.createCheckoutSessionConfig=amazon_payments_advanced.create_checkout_session_config;return a}(i),t=amazon_payments_advanced.create_checkout_session_hash,c=e.data("amazonRenderedSettings");if(void 0!==c){if(c===t)return;var r=h("<"+e.get(0).tagName+"/>").attr("id",n);r.insertBefore(e),e.remove(),e=r}e.data("amazonRenderedSettings",t),d=amazon.Pay.renderButton(a,o),e.siblings(".wc-apa-button-separator").show()}}),d}}function a(e,a){var n=h(e);0!==n.length&&n.data("wc_apa_chage_bind")!==a&&(n.data("wc_apa_chage_bind",a),n.on("click",function(e){e.preventDefault()}),amazon.Pay.bindChangeAction(e,{amazonCheckoutSessionId:amazon_payments_advanced.checkout_session_id,changeAction:a}))}function n(e){0===h("."+e+"__field-wrapper").children().filter(function(){return h(this).is(":not(.hidden)")&&"none"!==h(this).css("display")}).length?h("."+e).addClass("hidden"):h("."+e).removeClass("hidden")}function u(e){!function(e){return e.is(".processing")||e.parents(".processing").length}(e)&&e.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}function p(e){e.removeClass("processing").unblock()}function l(e){var o=h(this);if(e.preventDefault(),!o.data("sending")){o.data("sending",!0);var t=o.parents(".create-account");u(t),h.ajax({type:"post",url:o.prop("href"),success:function(e){p(t),o.data("sending",!1)},error:function(e,a,n){p(t),o.data("sending",!1)}})}}function e(){if(0<h("#amazon-logout").length&&"amazon_payments_advanced"===h("input[name=payment_method]:checked").val()){if(n("woocommerce-billing-fields"),n("woocommerce-shipping-fields"),n("woocommerce-additional-fields"),a("#payment_method_widget_change","changePayment"),a("#shipping_address_widget_change","changeAddress"),0<h(".woocommerce-billing-fields .woocommerce-billing-fields__field-wrapper > *").length&&h(".woocommerce-billing-fields").insertBefore("#payment"),0<h(".woocommerce-account-fields").length&&h(".woocommerce-account-fields").insertBefore("#wc-apa-account-fields-anchor"),0<h(".woocommerce-shipping-fields .woocommerce-shipping-fields__field-wrapper > *").length){var e=h("#ship-to-different-address");e.find(":checkbox#ship-to-different-address-checkbox").hide(),e.find("span").text(amazon_payments_advanced.shipping_title),h(".woocommerce-shipping-fields").insertBefore("#payment")}h(".woocommerce-additional-fields").insertBefore("#payment"),h(".wc-apa-send-confirm-ownership-code").on("click",l)}}d(),h(document.body).on("updated_wc_div",d),h(document.body).on("updated_checkout",d),h(document.body).on("payment_method_selected",d),h(document.body).on("updated_shipping_method",d),e(),h("body").on("updated_checkout",e),h("body").on("payment_method_selected",e)})}(jQuery);
