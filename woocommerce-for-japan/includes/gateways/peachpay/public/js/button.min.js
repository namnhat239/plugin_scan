let variationID="";let loaded=false;let buttonClickedBeforeLoad=false;let buttonClickedBeforeLoadID="";let ppInitMessageSent=false;let ppButtonShine=false;const selectedOutOfStockItems=new Set;const pendingVariationDetailRequests=0;const peachpayVersion=peachpay_data.version;if(peachpay_data.hide_mini_cart!=="1"){self.addEventListener("DOMContentLoaded",()=>{peachpay_placeButtonMiniCart();jQuery(document.body).on("wc_fragments_loaded wc_fragments_refreshed",()=>{peachpay_placeButtonMiniCart()})})}function ppOnWindowDataFetch(endpoint,requestCallback){self.addEventListener("message",async message=>{if(message.data.event===endpoint){try{const response=await requestCallback(message.data.request);message.ports[0].postMessage({result:response})}catch(error){message.ports[0].postMessage({error:error})}}})}function ppOnWindowMessage(eventName,cb){self.addEventListener("message",async event=>{if(event.data.event===eventName){await cb(event.data)}},false)}ppOnWindowDataFetch("pp-create-stripe-payment-intent",async request=>{const formData=new FormData;formData.append("session[id]",request.session.id);formData.append("session[stripe][customer_id]",request.session.stripe.customer_id);formData.append("session[stripe][connect_id]",request.session.stripe.connect_id);formData.append("session[stripe][payment_method_id]",request.session.stripe.payment_method_id);formData.append("session[stripe][payment_method_type]",request.session.stripe.payment_method_type);formData.append("order[id]",request.order.id);formData.append("order[data]",JSON.stringify(request.order.data));const response=await fetch(`${peachpay_data.wp_site_url}?wc-ajax=pp-create-stripe-payment-intent`,{method:"POST",body:formData});if(!response.ok){return null}return response.json()});ppOnWindowDataFetch("pp-place-order",placeOrder);ppOnWindowDataFetch("pp-set-order-status",async data=>{const response=await setOrderStatus(data.order.id,{status:data.order.status,message:data.order.message,paymentMethod:{method:data.order.paymentMethod,id:data.order.stripeCustomerId,transactionID:data.order.paypalTransactionId}});if(response.ok){return true}return false});ppOnWindowDataFetch("pp-add-order-note",async data=>{const formData=new FormData;formData.append("id",data.id);formData.append("note",data.note);const response=await fetch(`${peachpay_data.wp_site_url}?wc-ajax=pp-order-note`,{method:"POST",body:formData});return response.ok});ppOnWindowDataFetch("pp-validate-billing-address",data=>validateAddress(formDataFromAddress(data)));ppOnWindowDataFetch("pp-calculate-cart",async data=>{const formData=new FormData;if(!data.initial){for(const methodKey of Object.keys(data.order.selected_shipping)){formData.append(`order[selected_shipping][${methodKey}]`,data.order.selected_shipping[methodKey])}formData.append("order[shipping_location][country]",data.order.shipping_location.country);formData.append("order[shipping_location][state]",data.order.shipping_location.state);formData.append("order[shipping_location][city]",data.order.shipping_location.city);formData.append("order[shipping_location][postcode]",data.order.shipping_location.postcode)}const response=await fetch(`${peachpay_data.wp_home_url}/?wc-ajax=pp-cart`,{method:"POST",headers:{credentials:"same-origin"},body:formData});if(!response.ok){const error=new Error(`Cart calculation failed on ${peachpay_data.wp_home_url}`);captureSentryException(error);throw error}const cartCalculationResponse=await response.json();if(cartCalculationResponse.success&&cartCalculationResponse.data){peachpay_data.cart=cartCalculationResponse.data.cart_calculation_record[0].cart}return cartCalculationResponse});ppOnWindowDataFetch("pp-change-quantity",async data=>{const response=await peachpay_changeQuantity(data);if(!response.ok){throw new Error("Quantity failed to change.")}const responseData=await response.json();if(responseData.success&&responseData.data){peachpay_data.cart=responseData.data.cart_calculation_record[0].cart}return responseData});self.addEventListener("message",async event=>{if(event.data==="openModal"){document.querySelector("#peachpay-iframe").classList.remove("hide");document.querySelector("#peachpay-iframe").contentWindow.postMessage({event:"UI::modalOpened"},"*");document.querySelector("#loading-spinner-iframe").classList.add("hide");document.querySelector("#pp-modal-overlay").style.display="block";document.body.style.overflow="hidden";document.body.style.position="fixed";document.body.style.touchAction="none";peachpay_hideLoadingSpinner()}if(event.data.event==="peachpayAlert"){alert(event.data.message);if(event.data.action){switch(event.data.action){case"closeModal":closeModal();if(php_data.feature_support.currency_switcher_input.enabled){window.location.reload()}break;default:break}}}if(event.data.event==="currencyUpdate"){await updateCurrencyCookie(event.data.currency)}if(event.data==="closeModal"){closeModal();if(peachpay_data.feature_support.currency_switcher_input&&peachpay_data.feature_support.currency_switcher_input.enabled===true){window.location.reload()}}if(event.data==="pp-loaded"){loaded=true;if(buttonClickedBeforeLoad){const options={isMiniCart:buttonClickedBeforeLoadID==="pp-button-mini",clickID:buttonClickedBeforeLoadID};sendButtonClickedMessage(options)}}if(event.data.event==="fetchCoupon"){fetchAndSendCoupon(event)}if(event.data.event==="placeOrderDirectly"){placeOrderViaWCAjax(event.data)}if(event.data.event==="emailExist"){const emailResult=await fetchEmailData(event.data.email);document.querySelector("#peachpay-iframe").contentWindow.postMessage({event:"emailExist",emailResult:emailResult},"*")}if(event.data.event==="redeemGiftCard"){redeemGiftCard(peachpay_data,event.data.cardNumber)}if(event.data.event==="validateAddress"){validate(formDataFromAddress(event.data.billingAddress))}if(event.data.event==="setOrderStatus"){const response=await setOrderStatus(event.data.orderID,{status:event.data.status,message:event.data.message,paymentMethod:{method:event.data.paymentType,id:event.data.customerStripeId,transactionID:event.data.transactionID}});if(response.ok&&event.data.redirectURL){window.location=event.data.redirectURL}}if(event.data.event==="paypalAlert"&&!alert(event.data.message)){document.querySelector("#peachpay-iframe").contentWindow.postMessage({event:"paypalRestart"},"*")}if(event.data.event==="addLinkedProduct"||event.data.event==="addUpsellItem"){const message="Something went wrong, please try again.";if(await peachpay_addLinkedProductToCart(event)){document.querySelector("#peachpay-iframe").contentWindow.postMessage({event:"pp-update-cart"},"*")}else{alert(message)}}});function closeModal(){if(window.location.href.includes("?open_peachpay")){window.location=`${peachpay_data.wc_cart_url}`}if(peachpay_data.is_checkout_page){jQuery(document.body).trigger("update_checkout",{update_shipping_method:false})}else{jQuery(document.body).trigger("wc_update_cart")}if(document.querySelector("#pp-button")&&document.querySelector("#pp-button").classList.contains("pp-button-float")){jQuery(document.body).trigger("wc_fragment_refresh")}document.querySelector("#peachpay-iframe").contentWindow.postMessage({event:"UI::modalClosed"},"*");document.querySelector("#pp-modal-overlay").style.display="none";document.body.style.overflow="auto";document.body.style.position="";document.body.style.touchAction="auto";window.scrollTo({top:0,behavior:"instant"})}function baseStoreURL(){return location.hostname==="localhost"?`http://${location.hostname}:8000`:`https://${peachpay_data.wp_hostname}`}function basePeachPayAPIURL(merchantHostname){if(peachpay_data.test_mode){switch(merchantHostname){case"store.local":case"woo.store.local":return"https://dev.peachpay.local";default:return"https://dev.peachpay.app"}}switch(merchantHostname){case"localhost":case"127.0.0.1":case"woo.peachpay.app":case"theme1.peachpay.app":case"theme2.peachpay.app":case"theme3.peachpay.app":case"theme4.peachpay.app":case"theme5.peachpay.app":case"qa.peachpay.app":case"demo.peachpay.app":return"https://dev.peachpay.app";case"store.local":case"woo.store.local":return"https://prod.peachpay.local";default:return"https://prod.peachpay.app"}}function isDevEnvironment(baseUrl){return baseUrl==="https://dev.peachpay.app"||baseUrl==="https://dev.peachpay.local"||baseUrl==="https://prod.peachpay.local"}function peachpay_initButton(options){peachpay_initButtonContainer(options);peachpay_initButtonEvents(options);if(ppInitMessageSent){return}ppInitMessageSent=true;peachpay_sendInitMessage()}document.addEventListener("DOMContentLoaded",()=>{if(!peachpay_data.cart){peachpay_data.cart=[]}if(document.querySelector("#pp-button")&&document.querySelector("#pp-button").classList.contains("pp-button-float")){if(!document.querySelector("#pp-modal-overlay")){document.querySelector("body").insertAdjacentHTML("beforeend",pp_checkoutForm)}peachpay_initButton({isMiniCart:false})}});function peachpay_initButtonEvents(options){const elmtIdExt=options.isMiniCart?"-mini":options.isShortcode?"-shortcode":"";const button=document.querySelector(`#pp-button${elmtIdExt}`);if(!peachpay_isElementor()&&!button.classList.contains("pp-button-float")){button.style.width=options.width||"100%";button.style.setProperty("--button-color",peachpay_data.button_color||"#ff876c");if(options.borderRadius&&!options.isMiniCart){button.style.borderRadius=options.borderRadius.toString()+"px"}}tryToMatchFontSize(button,options.isMiniCart);if(shouldRedirectToCartPage()){button.addEventListener("click",async()=>{peachpay_showLoadingSpinner(options.isMiniCart);if(!peachpay_validateProductPageForm(options.isMiniCart)){peachpay_hideLoadingSpinner();return}const success=await peachpay_addProductToCart(options.isMiniCart);if(success){window.location=`${peachpay_data.wc_cart_url}?open_peachpay`}peachpay_hideLoadingSpinner()});return}button.addEventListener("click",event=>{if(button.classList.contains("pp-button-float")&&document.querySelector("#pp-item-count")&&parseInt(document.querySelector("#pp-item-count").innerHTML)===0){document.querySelector("#empty-cart-msg").classList.remove("hide");setTimeout(()=>{document.querySelector("#empty-cart-msg").classList.add("hide")},1e3)}else{openPeachPay({event:event,options:options})}});const urlParameters=new URLSearchParams(location.search);if(urlParameters.has("open_peachpay")){document.querySelector("#peachpay-iframe").classList.add("hide");document.querySelector("#loading-spinner-iframe").classList.remove("hide");document.querySelector("#pp-modal-overlay").style.display="flex";document.querySelector("body").style.overflow="hidden";openPeachPay({alternateEvent:"pp-button",options:options})}}function tryToMatchFontSize(button,isMiniCart){if(isMiniCart){return}const selector=peachpay_data.is_cart_page?".wc-proceed-to-checkout .button.checkout-button":'button[name="add-to-cart"]';const elementToCopy=document.querySelector(selector);const buttonIcon=document.querySelector("#button-icon-regular");if(elementToCopy){button.style.fontSize=window.getComputedStyle(elementToCopy).fontSize;if(window.getComputedStyle(elementToCopy).fontSize>"16px"&&buttonIcon){if(peachpay_data.button_icon==="mountain"){buttonIcon.style.height="18px"}else{buttonIcon.style.width="1.5rem";buttonIcon.style.height="1.5rem"}}}}function shouldRedirectToCartPage(){if(peachpay_data.is_cart_page||peachpay_data.is_checkout_page){return false}const sites=new Set(["counterattackgame.com"]);if(sites.has(location.hostname)){return true}return false}function openPeachPay(context){let targetID="";if(context.event){targetID=context.event.currentTarget?context.event.currentTarget.id:"redirect"}else{targetID=context.alternateEvent}peachpay_showLoadingSpinner(context.options.isMiniCart);if(!loaded||pendingVariationDetailRequests>0){buttonClickedBeforeLoad=true;buttonClickedBeforeLoadID=targetID;return}context.options.clickID=targetID;sendButtonClickedMessage(context.options)}function peachpay_initButtonContainer(options){if(options.isMiniCart||options.isShortcode){return}const container=document.querySelector("#pp-button-container");if(!peachpay_isElementor()){container.style.textAlign=options.alignment||"inherit"}container.style.justifyContent=options.alignment||"inherit"}function peachpay_sendInitMessage(){const peachpay=document.querySelector("#peachpay-iframe");peachpay.addEventListener("load",()=>{peachpay.contentWindow.postMessage({event:"init",merchantHostname:peachpay_data.wp_hostname,isTestMode:peachpay_data.test_mode,isCartPage:peachpay_data.is_cart_page,isCheckoutPage:peachpay_data.is_checkout_page,isShopPage:peachpay_data.is_shop_page,isGroupedProduct:isGroupedProduct(),isMobile:peachpay_isMobile(),phpData:peachpay_data,browserLocale:navigator.language||"en-US",pageLanguage:languageCodeToLocale(getPageLanguage())},"*")})}function getPageLanguage(){const $html=document.querySelector("html");if(!$html){return"en-US"}return document.querySelector("html").lang||"en-US"}function peachpay_isProductInWCCart(formData){let isBundleProduct=false;let variationId=Number.parseInt(formData.get("variation_id"));for(const key of formData.keys()){if(key.includes("bundle_variation")){isBundleProduct=true;variationId=Number.parseInt(formData.get(key))}}const productId=Number.parseInt(formData.get("add-to-cart"));for(const item of peachpay_data.cart){if(isBundleProduct){if(Number.parseInt(item.product_id)===variationId){return true}}else if((Number.parseInt(item.product_id)===variationId||Number.parseInt(item.product_id)===productId)&&!item.is_part_of_bundle){return true}}return false}async function sendButtonClickedMessage(options){const isShopPage=document.querySelector("#pp-button")&&document.querySelector("#pp-button").classList.contains("pp-button-float");const isProductPage=!peachpay_data.is_cart_page&&!peachpay_data.is_checkout_page&&!options.isMiniCart&&!isShopPage;if(isProductPage||options.isShortcode){if(!peachpay_validateProductPageForm(options)){peachpay_hideLoadingSpinner();return}if(!peachpay_isProductInWCCart(peachpay_getAddToCartFormData(options))){const success=await peachpay_addProductToCart(options);peachpay_hideLoadingSpinner();if(!success){return}}}const data={event:"buttonClicked",buttonID:options.clickID};const peachpay=document.querySelector("#peachpay-iframe");peachpay.contentWindow.postMessage(data,"*")}function peachpay_validateProductPageForm(options){if(options.isShortcode){return true}if(!checkValidityOf("form.cart")){return false}if(!inStockAndVariationSelected(options.isShortcode)){return false}return true}function peachpay_insertFragments(fragments){for(const fragmentKey of Object.keys(fragments)){const $target=document.querySelector(fragmentKey);if(!$target){continue}$target.innerHTML=fragments[fragmentKey]}}function peachpay_refreshFragments(response){if(response){response.json().then(data=>{peachpay_insertFragments(data.fragments)}).catch(()=>{});return}fetch(`${peachpay_data.wp_home_url}/?wc-ajax=get_refreshed_fragments`,{method:"POST",time:Date.now()}).then(response=>{if(!response.ok){return}return response.json()}).then(data=>{peachpay_insertFragments(data.fragments)}).catch(()=>{})}function checkValidityOf(selector){const $form=document.querySelector(selector);let result=false;if($form){result=$form.reportValidity()}return result}function inStockAndVariationSelected(isMiniCart){const multipleProducts=Array.from(document.querySelectorAll("input.variation_id")).length>1;if(selectedOutOfStockItems.size>0&&!isMiniCart){alert(pp_i18n[`out-of-stock${multipleProducts?"-bundle":""}`][getLanguage()]);buttonClickedBeforeLoad=false;peachpay_hideLoadingSpinner();return false}if(!variationSelected()&&!isMiniCart){alert(pp_i18n[`select-variation${multipleProducts?"-bundle":""}`][getLanguage()]);buttonClickedBeforeLoad=false;return false}return true}function setDetectChangeHandler(input){const superProps=Object.getPrototypeOf(input);const superSet=Object.getOwnPropertyDescriptor(superProps,"value").set;const superGet=Object.getOwnPropertyDescriptor(superProps,"value").get;const newProps={get:function(){return Reflect.apply(superGet,this,arguments)},set:function(){setTimeout(()=>this.dispatchEvent(new Event("change")),50);return Reflect.apply(superSet,this,arguments)}};Object.defineProperty(input,"value",newProps)}function setCustomVariationChangeHandler(input){setDetectChangeHandler(input);input.addEventListener("change",event=>{if(event.target.value===""){return}variationID=event.target.value;updateOutOfStockSelection(variationID)})}document.addEventListener("DOMContentLoaded",()=>{const $variations=Array.from(document.querySelectorAll(".variation_id"));for(const $v of $variations){setCustomVariationChangeHandler($v)}});function updateOutOfStockSelection(variationID){if(collectVariationStock().get(variationID)){const selectedOutOfStockItemsArray=Array.from(selectedOutOfStockItems);for(let i=0;i<selectedOutOfStockItems.size;i++){const group=collectVariationGroup(selectedOutOfStockItemsArray[i]);if(group.includes(variationID)&&variationID!==selectedOutOfStockItemsArray[i]){selectedOutOfStockItems.delete(selectedOutOfStockItemsArray[i])}}}else{selectedOutOfStockItems.add(variationID)}}async function fetchEmailData(email){const response=await fetch(`${baseStoreURL()}/wp-json/peachpay/v1/check/email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:email})});const result=await response.json();return result.emailExists}function sendStopPaymentProcessingAnimationsMessage(options){document.querySelector("#peachpay-iframe").contentWindow.postMessage({event:"stopPaymentProcessingAnimations",closeModal:options&&options.closeModal||false,errorMessage:options&&options.errorMessage?options.errorMessage:null},"*")}async function placeOrder(data){if(!peachpay_data.has_valid_key){peachpay_promptPermissions();return}if(peachpay_data.plugin_routeapp_active){await removeRouteFee()}const isBeYourBag=location.hostname==="www.beyourbag.it"||location.hostname==="woocommerce-187306-844159.cloudwaysapps.com";const formData=formDataFromAddress(data.order.billingAddress);formData.append("peachpay_checkout_nonce",peachpay_data.checkout_nonce);formData.append("payment_method",data.order.paymentMethod==="paypal"?"peachpay_paypal":"peachpay_stripe");formData.append("ship_to_different_address",1);formData.append("terms",isBeYourBag?"on":1);formData.append("european_gdpr",1);formData.append("ct-ultimate-gdpr-consent-field","on");formData.append("ct-ultimate-gdpr-consent-field-additional","1");formData.append("ct-ultimate-gdpr-consent-field-label-text","1");formData.append("delivery_date",data.order.deliveryDate);if(location.hostname==="www.veilevents.com"){formData.append("shipping_company",`${data.order.billingAddress.billing_first_name} ${data.order.billingAddress.billing_last_name}`);formData.append("additional_where","Website")}if(data.order.merchantCustomerAccountPassword&&data.order.merchantCustomerAccountPassword!==""){formData.append("account_password",data.order.merchantCustomerAccountPassword)}if(data.order.customerOrderNotes&&data.order.customerOrderNotes!==""){formData.append("order_comments",data.order.customerOrderNotes)}for(const[packageKey,selectedOption]of Object.entries(data.order.shippingMethods)){formData.append(`shipping_method[${packageKey}]`,selectedOption)}if(data.order.additionalFields&&data.order.additionalFields.length>0){for(const field of data.order.additionalFields){formData.append(field.name,field.value)}}const orderResponse=await fetch(`${baseStoreURL()}/?wc-ajax=pp-order-create`,{method:"POST",credentials:"same-origin",body:formData});const orderResult=await orderResponse.json();if(orderResult.result==="failure"||orderResult.success===false){orderResult.result="failure";if(orderResult.data){const message=`<ul class="woocommerce-error message-wrapper" role="alert">
			<li>
				<div class="message-container container alert-color medium-text-center">
					<span class="message-icon icon-close"></span>
					${orderResult.data}
				</div>
			</li>
			</ul>`;orderResult.messages=message}const errorContext={type:"WC-Order",merchant:location.hostname,sessionID:data.session.id,createOrderResponseStatus:orderResponse.status,orderResult:orderResult,orderResultErrorText:parseWooCommerceHTMLError(orderResult.messages),formData:Object.fromEntries(formData)};await fetch(`${basePeachPayAPIURL(location.hostname)}/api/v1/error-log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errorContext:errorContext})});return orderResult}await removeGiftCardsFromSession();if(!orderResult.details){const id=orderIDFromRedirect(orderResult.redirect);orderResult.orderID=id;orderResult.number=id;orderResult.details={id:id,order_key:orderKeyFromRedirect(orderResult.redirect),total:"0"}}return orderResult}function peachpay_promptPermissions(){if(confirm("PeachPay requires permission to place test orders. Would you like to give permission? (Page will redirect)")){window.location=peachpay_data.authorize_url}closeModal()}async function placeOrderViaWCAjax(data){if(!peachpay_data.has_valid_key){peachpay_promptPermissions();return}if(peachpay_data.plugin_routeapp_active){await removeRouteFee()}const isBeYourBag=location.hostname==="www.beyourbag.it"||location.hostname==="woocommerce-187306-844159.cloudwaysapps.com";const formData=formDataFromAddress(data.billingAddress);formData.append("peachpay_checkout_nonce",peachpay_data.checkout_nonce);formData.append("payment_method",data.isPaypal?"peachpay_paypal":"peachpay_stripe");formData.append("ship_to_different_address",1);formData.append("terms",isBeYourBag?"on":1);formData.append("european_gdpr",1);formData.append("ct-ultimate-gdpr-consent-field","on");formData.append("ct-ultimate-gdpr-consent-field-additional","1");formData.append("ct-ultimate-gdpr-consent-field-label-text","1");formData.append("delivery_date",data.deliveryDate);if(location.hostname==="www.veilevents.com"){formData.append("shipping_company",`${data.billingAddress.billing_first_name} ${data.billingAddress.billing_last_name}`);formData.append("additional_where","Website")}if(data.merchantCustomerAccountPassword&&data.merchantCustomerAccountPassword!==""){formData.append("account_password",data.merchantCustomerAccountPassword)}if(data.customerOrderNotes&&data.customerOrderNotes!==""){formData.append("order_comments",data.customerOrderNotes)}for(const[packageKey,selectedOption]of Object.entries(data.shipping_method)){formData.append(`shipping_method[${packageKey}]`,selectedOption)}if(data.additionalFields&&data.additionalFields.length>0){for(const field of data.additionalFields){formData.append(field.name,field.value)}}const orderResponse=await fetch(`${baseStoreURL()}/?wc-ajax=pp-order-create`,{method:"POST",credentials:"same-origin",body:formData});const orderResult=await orderResponse.json();if(orderResult.result==="failure"||orderResult.success===false){if(orderResult.data){const message=`<ul class="woocommerce-error message-wrapper" role="alert">
			<li>
				<div class="message-container container alert-color medium-text-center">
					<span class="message-icon icon-close"></span>
					${orderResult.data}
				</div>
			</li>
			</ul>`;orderResult.messages=message}const errorContext={type:"WC-Order",merchant:location.hostname,sessionID:data.sessionID,createOrderResponseStatus:orderResponse.status,orderResult:orderResult,orderResultErrorText:parseWooCommerceHTMLError(orderResult.messages),formData:Object.fromEntries(formData)};await fetch(`${basePeachPayAPIURL(location.hostname)}/api/v1/error-log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errorContext:errorContext})});sendStopPaymentProcessingAnimationsMessage({closeModal:false,errorMessage:orderResult.messages.replace(/ {2}|\r\n|\n|\r|\t/gm,"")||null});return}await removeGiftCardsFromSession();if(!orderResult.details){const id=orderIDFromRedirect(orderResult.redirect);orderResult.orderID=id;orderResult.number=id;orderResult.details={id:id,order_key:orderKeyFromRedirect(orderResult.redirect),total:"0"}}document.querySelector("#peachpay-iframe").contentWindow.postMessage({event:data.isPaypal?"submitPaypalOrder":"submitPayment",order:orderResult},"*")}function orderIDFromRedirect(url){const parts=url.split("/");return parts[parts.length-2]}function orderKeyFromRedirect(url){const parameters=new URLSearchParams(url.split("?")[1]);return parameters.get("key")}function formDataFromAddress(address){const formData=new FormData;formData.append("billing_first_name",address.billing_first_name);formData.append("billing_last_name",address.billing_last_name);formData.append("billing_company",address.billing_company);formData.append("billing_email",address.billing_email);formData.append("billing_phone",address.billing_phone);formData.append("billing_country",address.billing_country);formData.append("billing_address_1",address.billing_address_1);formData.append("billing_address_2",address.billing_address_2);formData.append("billing_city",address.billing_city);formData.append("billing_state",address.billing_state);formData.append("billing_postcode",address.billing_postcode);formData.append("shipping_first_name",address.billing_first_name);formData.append("shipping_last_name",address.billing_last_name);formData.append("shipping_company",address.billing_company);formData.append("shipping_country",address.billing_country);formData.append("shipping_address_1",address.billing_address_1);formData.append("shipping_address_2",address.billing_address_2);formData.append("shipping_city",address.billing_city);formData.append("shipping_state",address.billing_state);formData.append("shipping_postcode",address.billing_postcode);formData.append("shipping_phone",address.billing_phone);return formData}async function peachpay_addProductToCart(options){if(options.isMiniCart){return true}try{const formData=peachpay_getAddToCartFormData(options);const response=await fetch(peachpay_data.wp_home_url+"/?wc-ajax=add-to-cart",{method:"POST",headers:{Accept:"application/json"},body:formData});if(!response.ok){return false}peachpay_refreshFragments(response);return true}catch(error){if(error instanceof Error){captureSentryException(new Error(`Product page "add to cart" failed on ${peachpay_data.wp_home_url}. Error: `+error.message));alert(pp_i18n["place-order-failure"][getLanguage()])}return false}}function peachpay_getAddToCartFormData(options){if(options.isShortcode){return peachpay_getShortCodeAddToCartFormData(options)}const $form=document.querySelector("form.cart");const formData=new FormData($form);const $submitButton=$form.querySelector('button[name="add-to-cart"]');if($submitButton){formData.append("add-to-cart",$submitButton.value)}return formData}function setOrderStatus(orderID,{status,message,paymentMethod}){const formData=new FormData;formData.append("order_id",orderID);formData.append("transaction_id",paymentMethod.transactionID);if(status==="wc-processing"){formData.append("status","success")}else{formData.append("status","failed");formData.append("status_message",message)}return fetch(`${peachpay_data.wp_site_url}/?wc-ajax=pp-order-status`,{method:"POST",body:formData})}function parseWooCommerceHTMLError(html){const element=document.createElement("div");element.innerHTML=html;const iter=document.createNodeIterator(element,NodeFilter.SHOW_TEXT);let textNode=iter.nextNode();let messageText="";let i=0;while(textNode){const text=textNode.textContent.trim();if(text===""||text==="\t"||text==="\n"){textNode=iter.nextNode();continue}messageText+=text;if(i>0){messageText+=" "}textNode=iter.nextNode();i++}return messageText.trim()}async function removeRouteFee(){const data=new FormData;data.append("action","woo_get_ajax_data");data.append("checkbox",false);const response=await fetch(peachpay_data.wp_ajax_url,{method:"POST",body:data});return response.status===200}async function validate(formData){const success=await validateAddress(formData);const event=success?"validateAddressSuccess":"hideContinueSpinner";document.querySelector("#peachpay-iframe").contentWindow.postMessage({event:event},"*")}async function validateAddress(formData){const response=await fetch(`${baseStoreURL()}/wp-json/peachpay/v1/checkout/validate`,{method:"POST",body:formData});if(response.status!==200){const error=await response.json();alert(clean(error.message));return false}return true}function clean(message){return message.replaceAll("Billing","Shipping").replaceAll("billing","shipping").replace(/(<([^>]+)>)/gi,"")}function isGroupedProduct(){return document.querySelector("form.cart.grouped_form")!==null}function variationSelected(){let $variations=Array.from(document.querySelectorAll("input.variation_id"));if(location.hostname==="www.kidtoes.com"&&peachpay_data.is_cart_page===""){const summary=document.querySelector(".summary-inner");$variations=summary.querySelectorAll("input.variation_id")}for(const variation of $variations){if(variation!==null&&(variation.value==="0"||variation.value==="")){peachpay_hideLoadingSpinner();return false}}return true}function collectVariationStock(){const $forms=Array.from(document.querySelectorAll(".variations_form"));const variationInStock=new Map;for(const $form of $forms){const variations=JSON.parse($form.dataset.product_variations);for(const v of variations){variationInStock.set(String(v.variation_id),v.is_in_stock)}}return variationInStock}function collectVariationGroup(variationID){const $forms=Array.from(document.querySelectorAll(".variations_form"));const group=[];for(const $form of $forms){let found=false;const variations=JSON.parse($form.dataset.product_variations);for(const v of variations){if(String(v.variation_id)===variationID){found=true}}if(found){for(const v of variations){group.push(String(v.variation_id))}break}}return group}function peachpay_showLoadingSpinner(isMiniCart){if(isMiniCart){return}if(document.querySelector("#pp-button")&&!document.querySelector("#pp-button").classList.contains("pp-button-float")){document.querySelector("#loading-spinner").classList.remove("hide");document.querySelector("#pp-button-content").classList.add("hide")}const $ppButton=document.querySelector("#pp-button");if($ppButton){$ppButton.disabled=true}}function peachpay_hideLoadingSpinner(){const loadingSpinner=document.querySelector("#loading-spinner");if(loadingSpinner){loadingSpinner.classList.add("hide")}const buttonContent=document.querySelector("#pp-button-content");if(buttonContent){buttonContent.classList.remove("hide")}const $ppButton=document.querySelector("#pp-button");if($ppButton){$ppButton.disabled=false}}function spinnerURL(){const dark=location.hostname==="www.blazecandles.co"?"-dark":"";return`${peachpay_data.plugin_asset_url}public/img/spinner${dark}.svg`}function peachpay_isMobile(){return/Mobi/.test(navigator.userAgent)}window.pp_peachpayButton=`
<div id="pp-button-container" class="button-container pp-button-container ${peachpay_data.test_mode&&!peachpay_data.wp_admin_or_editor?"hide":""}">
	<div id="pp-stripe-payment-request-btn" style="width: 100%; margin: 5px 0; display: none;">
	</div>
	<button id="pp-button" class="pp-button" type="button" style="display: block;">
		<object
			type="image/svg+xml"
			data="${spinnerURL()}"
			id="loading-spinner"
			class="pp-spinner"
			height="20"
			width="20">
		</object>
		<div id="pp-button-content">
			<span id="pp-button-text">${peachpay_data.button_text}</span>
			<img id="button-icon-regular" class=""/>
		</div>
	</button>
	<div id="payment-methods-container" class="cc-company-logos">
		<img class="${peachpay_data.feature_support.paypal_payment_method.enabled?"cc-logo":"hide"}" src="${peachpay_data.plugin_asset_url}public/img/marks/paypal.svg"/>
		<img class="cc-logo" src="${peachpay_data.plugin_asset_url}public/img/marks/visa.svg"/>
		<img class="cc-logo" src="${peachpay_data.plugin_asset_url}public/img/marks/amex.svg"/>
		<img class="cc-logo" src="${peachpay_data.plugin_asset_url}public/img/marks/discover.svg"/>
		<img class="cc-logo" src="${peachpay_data.plugin_asset_url}public/img/marks/mastercard.svg"/>
		<img class="cc-logo" src="${peachpay_data.plugin_asset_url}public/img/marks/cc-stripe-brands.svg"/>
	</div>
</div>
`;window.pp_peachpayButtonMiniCart=`
<div id="pp-button-container-mini" class="button-container pp-button-container ${peachpay_data.test_mode&&!peachpay_data.wp_admin_or_editor?"hide":""}">
	<button id="pp-button-mini" class="pp-button ${peachpay_data.disable_default_font_css=="1"?"":"pp-button-default-font"}" type="button" style="display: block;">
		<div id="pp-button-content-mini">
			<span id="pp-button-text-mini">${peachpay_data.button_text}</span>
			<img id="button-icon-minicart" class=""/>
		</div>
	</button>
	<div id="payment-methods-container-minicart" class="cc-company-logos">
		<img class="${peachpay_data.feature_support.paypal_payment_method.enabled?"cc-logo-sidebar":"hide"}" src="${peachpay_data.plugin_asset_url}public/img/marks/paypal.svg"/>
		<img class="cc-logo-sidebar" src="${peachpay_data.plugin_asset_url}public/img/marks/visa.svg"/>
		<img class="cc-logo-sidebar" src="${peachpay_data.plugin_asset_url}public/img/marks/amex.svg"/>
		<img class="cc-logo-sidebar" src="${peachpay_data.plugin_asset_url}public/img/marks/discover.svg"/>
		<img class="cc-logo-sidebar" src="${peachpay_data.plugin_asset_url}public/img/marks/mastercard.svg"/>
		<img class="cc-logo-sidebar" src="${peachpay_data.plugin_asset_url}public/img/marks/cc-stripe-brands.svg"/>
	</div>
</div>
`;window.pp_checkoutForm=`
<div id="pp-modal-overlay" class="pp-overlay">
	<img src="${spinnerURL()}" id="loading-spinner-iframe" class="pp-spinner-iframe hide">
	<iframe id="peachpay-iframe" src="${peachpay_data.plugin_asset_url}public/dist/${peachpay_data.version}/checkout-modal/peachpay-checkout.html">
		Unable to load PeachPay Checkout
	</iframe>
</div>
<div class="peachpay-translate-helper" style="height:0;width:0;overflow:hidden;">translate me</div>
`;const peachpay_stock_observer=new MutationObserver(function(){let needs_muted=false;const checkout_button=document.getElementsByClassName("single_add_to_cart_button");if(checkout_button[0]){const cL=checkout_button[0].classList;if(cL.contains("disabled")){needs_muted=true}}const button=document.querySelector("#pp-button");if(button){if(needs_muted){button.classList.add("pp-button-mute");if(ppButtonShine){button.classList.remove("pp-button-shine")}}else{button.classList.remove("pp-button-mute");if(ppButtonShine){button.classList.add("pp-button-shine")}}}});peachpay_stock_observer.observe(document,{childList:true,subtree:true});document.addEventListener("DOMContentLoaded",()=>peachpay_addCustomMerchantStyles());function peachpay_addCustomMerchantStyles(){if(!peachpay_isElementor()&&!peachpay_data.button_sheen){ppButtonShine=true}if(!peachpay_isElementor()&&peachpay_data.button_fade){peachpay_buttonFade()}if(!peachpay_isElementor()&&!peachpay_data.disable_default_font_css){peachpay_defaultFontCSS()}if(document.querySelector("#payment-methods-container")&&peachpay_data.button_hide_payment_method_icons){document.querySelector("#payment-methods-container").classList.add("hide")}if(document.querySelector("#button-icon-regular")){update_buttonIcon(peachpay_data.button_icon,"regular")}if(location.hostname==="www.traveltek.com.au"){peachpay_traveltek()}if(location.hostname==="katekos.com"){peachpay_katekos()}if(location.hostname==="skregear.com"){peachpay_skregear()}if(location.hostname==="waterluxe-osmosis.es"){document.querySelector("#pp-button-text").textContent="Compra ahora"}if(location.hostname==="www.enotecacorsetti.com"){removeBorderRadius()}if(location.hostname==="agirlsbestfriend.ie"){removeBorderRadius()}if(location.hostname==="salafibookstore.com"){peachpay_salafibookstore()}if(location.hostname==="scrummysweets.co"){const button=document.querySelector("#pp-button-text");if(!button){return}button.textContent="PRE-ORDER NOW"}if(location.hostname==="www.irish-pure.de"){document.querySelector("#pp-button-text").textContent="Kreditkarte"}if(location.hostname==="www.bimbiallamoda.com"){const button=document.querySelector("#pp-button-text");if(button){button.textContent="Acquista con 1 clic"}}if(location.hostname==="airthreds.com"){peachpay_airthreds()}if(location.hostname==="www.kidtoes.com"){peachpay_kidtoes()}if(location.hostname==="rahimsapphire.co.uk"){peachpay_rahimsapphire()}if(location.hostname==="strandsofhumanity.com"){peachpay_strandsofhumanity()}if(location.hostname==="www.blazecandles.co"){peachpay_blazeCandle()}if(location.hostname==="www.grandbazaarist.com"){peachpay_grandbazaarist()}pp_placeButtonCustomCheckoutPage()}function peachpay_buttonFade(){const body=document.querySelector("body");if(body){body.insertAdjacentHTML("beforeend",peachpay_buttonFadeCSS)}}function peachpay_defaultFontCSS(){const ppButtons=document.querySelectorAll(".pp-button");if(ppButtons[0]){ppButtons.forEach(ppButton=>{ppButton.classList.add("pp-button-default-font")})}}const peachpay_buttonFadeCSS=`
<style>
#pp-button-container .pp-button {
	color: #FFF;
	border: 2px solid var(--button-color);
	background: linear-gradient(to right,#fff 50%,var(--button-color) 50%);
	background-size: 210% 100%;
	background-position: right bottom;
	transition: all .4s ease;
	border-radius: 8px!important;
}
#pp-button-container .pp-button:hover, #pp-button-container .pp-button:focus {
	color: var(--button-color);
	border: 2px solid var(--button-color);
	background-position: left bottom;
}
.pp-button:hover {
	opacity: 1.00 !important;
}
</style>`;function peachpay_traveltek(){const peachpayButton=document.querySelector("#pp-button");if(!peachpayButton){return}peachpayButton.style.cssText+=';font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol" !important;';peachpayButton.style.cssText+=";text-transform: uppercase !important";peachpayButton.style.fontSize="12px";if(peachpay_data.is_cart_page){peachpayButton.style.fontSize="1.25em"}}function peachpay_katekos(){const peachpayButton=document.querySelector("#pp-button");if(!peachpayButton){return}peachpayButton.style.cssText+="text-transform: uppercase !important;";peachpayButton.style.fontSize="20px";peachpayButton.style.cssText+=";font-family: Raleway !important;";peachpayButton.style.fontWeight=400;peachpayButton.style.padding=peachpay_data.is_cart_page?"10px 0":"15px"}function peachpay_skregear(){const peachpayButton=document.querySelector("#pp-button");if(!peachpayButton){return}peachpayButton.style.borderRadius="0";peachpayButton.style.fontSize="16px";peachpayButton.style.fontWeight=700;peachpayButton.style.cssText+=";font-family: Lato !important;";peachpayButton.style.cssText+="text-transform: uppercase !important;";if(peachpay_data.is_cart_page){peachpayButton.style.fontSize="0.97em";peachpayButton.style.padding="0.62em"}document.querySelector("html").style["overflow-x"]="visible"}function removeBorderRadius(){const peachpayButton=document.querySelector("#pp-button");if(!peachpayButton){return}peachpayButton.style.borderRadius="0"}function peachpay_salafibookstore(){const peachpayButton=document.querySelector("#pp-button");if(!peachpayButton){return}peachpayButton.style.borderRadius="0";peachpayButton.style.cssText+="text-transform: uppercase !important;"}function peachpay_airthreds(){const button=document.querySelector("#pp-button");if(!button){return}button.style.borderRadius="50px";button.style.fontSize="20px";button.style.fontWeight="inherit";button.style.height="49px";button.style.padding="0";button.style.cssText+=";text-transform: none !important;";button.style.cssText+=";font-family: inherit !important;";if(peachpay_isMobile()){button.style.cssText+=";width: 100% !important;"}const buttonContainer=document.querySelector("#pp-button-container");buttonContainer.style.display=peachpay_isMobile()?"block":"inline";buttonContainer.style.verticalAlign="bottom";buttonContainer.style.marginLeft=peachpay_isMobile()||peachpay_data.is_cart_page?"0":"20px";const addToCartButton=document.querySelector(".single_add_to_cart_button");if(addToCartButton){addToCartButton.style.display="block";addToCartButton.style.marginTop="1.5rem"}const quantity=document.querySelector("form.cart .quantity");if(quantity){quantity.style.width="100%"}}function peachpay_kidtoes(){const buttonContainer=document.querySelector("#pp-button-content");if(!buttonContainer){return}buttonContainer.style.color="#ffffff"}function peachpay_rahimsapphire(){const button=document.querySelector("#pp-button");if(button){button.classList.add("rahimsapphire");button.style.cssText+=";text-transform: none !important;";document.querySelector("#pp-button-text").textContent="Quick Checkout"}const miniButton=document.querySelector("#pp-button-mini");if(miniButton){document.querySelector("#pp-button-text-mini").textContent="Quick Checkout";miniButton.classList.add("rahimsapphire");miniButton.style.paddingTop="16px";miniButton.style.paddingBottom="16px";miniButton.style.fontSize="100%";miniButton.style.transition="all .2s linear";miniButton.style.cssText+=";text-transform: none !important;"}else{self.requestAnimationFrame(peachpay_rahimsapphire)}}function peachpay_strandsofhumanity(){const sidebarButton=document.querySelector("#pp-button-mini");if(sidebarButton){document.querySelector("#pp-button-text-mini").textContent="Express Checkout";sidebarButton.style.fontSize="18px";sidebarButton.style.cssText+=';font-family: "Playfair Display", serif !important;'}}function peachpay_blazeCandle(){const button=document.querySelector("#pp-button");if(!button){return}if(peachpay_data.is_cart_page){button.style.fontWeight="normal";button.classList.add("blazecandle");button.style.setProperty("--button-color","none");button.style.background="none";button.style.color="black";button.style.border="1px solid #121212";button.style.borderRadius="100px"}}function peachpay_grandbazaarist(){const sidebarButton=document.querySelector("#pp-button-mini");if(sidebarButton){sidebarButton.style.marginRight="1em";sidebarButton.style.cssText+=";width: 95% !important;"}}function peachpayTestMode(){console.log("Peachpay Version: "+peachpay_data.version);if(document.querySelector("#pp-button-container")){document.querySelector("#pp-button-container").classList.remove("hide")}if(document.querySelector("#pp-button-container-mini")){document.querySelector("#pp-button-container-mini").classList.remove("hide")}}function update_buttonIcon(icon_value,buttonType){const icons=document.querySelector("#button-icon-"+buttonType);if(icons){if(buttonType==="regular"){icons.classList.remove("skre-icon");icons.classList.add("pp-btn-symbol")}else{icons.classList.remove("skre-icon-mini");icons.classList.add("pp-btn-symbol-mini")}icons.classList.remove("hide");const beyourbag=location.hostname==="www.beyourbag.it";switch(icon_value){case"lock":icons.src=`${peachpay_data.plugin_asset_url}public/img/lock${beyourbag?"-black":""}.svg`;break;case"baseball":icons.src=`${peachpay_data.plugin_asset_url}public/img/baseball-ball-solid.svg`;break;case"arrow":icons.src=`${peachpay_data.plugin_asset_url}public/img/chevron-circle-right-solid.svg`;break;case"mountain":if(buttonType==="regular"){icons.classList.remove("pp-btn-symbol");icons.classList.add("skre-icon")}else{icons.classList.remove("pp-btn-symbol-mini");icons.classList.add("skre-icon-mini")}icons.src=`${peachpay_data.plugin_asset_url}public/img/skre.svg`;break;case"bag":icons.src=`${peachpay_data.plugin_asset_url}public/img/briefcase-solid.svg`;break;default:icons.classList.add("hide")}}}function updateCurrencyCookie(newCurrency){document.cookie=`pp_active_currency=${newCurrency};path=/`}