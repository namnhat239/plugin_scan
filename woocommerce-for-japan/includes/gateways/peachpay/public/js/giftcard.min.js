const appliedGiftCards=[];async function redeemGiftCard(peachpayData,cardNumber){try{const data=new FormData;data.append("action","pw-gift-cards-redeem");data.append("card_number",cardNumber);data.append("security",peachpayData.pw_gift_cards_apply_nonce);const response=await fetch(peachpayData.wp_ajax_url,{method:"POST",body:data});const responseData=await response.json();if(response.ok&&responseData.success){appliedGiftCards.push(cardNumber)}else{return sendGiftCardAppliedMessage(false,null)}}catch{return sendGiftCardAppliedMessage(false,null)}const giftCard=await getGiftCardDetails(cardNumber);sendGiftCardAppliedMessage(giftCard!==null,giftCard)}async function getGiftCardDetails(cardNumber){try{const response=await fetch(`${baseStoreURL()}/wp-json/peachpay/v1/compatibility/pw-wc-gift-cards/card/${cardNumber}`);if(response.ok){return await response.json()}return null}catch{return null}}function sendGiftCardAppliedMessage(success,giftCard){let message=!success&&(giftCard&&giftCard.message)?giftCard.message:"";if(giftCard&&Number.parseFloat(giftCard.balance).toFixed(2)==="0.00"){success=false;message=pp_i18n["gift-card-zero-balance"][getLanguage()]}document.querySelector("#peachpay-iframe").contentWindow.postMessage({event:"giftCardApplied",success:success,message:message,giftCard:giftCard},"*")}async function removeGiftCardsFromSession(){if(appliedGiftCards){for(const cardNumber of appliedGiftCards){await removeGiftCardFromSession(cardNumber)}}}async function removeGiftCardFromSession(cardNumber){const data=new FormData;data.append("action","pw-gift-cards-remove");data.append("card_number",cardNumber);data.append("security",peachpay_data.pw_gift_cards_remove_nonce);const response=await fetch(peachpay_data.wp_ajax_url,{method:"POST",body:data});return response.status===200}