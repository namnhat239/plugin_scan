asl_jQuery(document).ready(function(){function t(t){t=t||{},google.maps.OverlayView.apply(this,arguments),this.content_=t.content||"",this.disableAutoPan_=t.disableAutoPan||!1,this.maxWidth_=t.maxWidth||0,this.pixelOffset_=t.pixelOffset||new google.maps.Size(0,0),this.position_=t.position||new google.maps.LatLng(0,0),this.zIndex_=t.zIndex||null,this.boxClass_=t.boxClass||"infoBox",this.boxStyle_=t.boxStyle||{},this.closeBoxMargin_=t.closeBoxMargin||"2px",this.closeBoxURL_=t.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",""===t.closeBoxURL&&(this.closeBoxURL_=""),this.infoBoxClearance_=t.infoBoxClearance||new google.maps.Size(1,1),"undefined"==typeof t.visible&&("undefined"==typeof t.isHidden?t.visible=!0:t.visible=!t.isHidden),this.isHidden_=!t.visible,this.alignBottom_=t.alignBottom||!1,this.pane_=t.pane||"floatPane",this.enableEventPropagation_=t.enableEventPropagation||!1,this.div_=null,this.closeListener_=null,this.moveListener_=null,this.contextListener_=null,this.eventListeners_=null,this.fixedWidthSet_=null}var e=function(){};window.asl_locator=e,t.prototype=new google.maps.OverlayView,t.prototype.createInfoBoxDiv_=function(){var t,e,i,o=this,n=function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()},s=function(t){t.returnValue=!1,t.preventDefault&&t.preventDefault(),o.enableEventPropagation_||n(t)};if(!this.div_){if(this.div_=document.createElement("div"),this.setBoxStyle_(),"undefined"==typeof this.content_.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+this.content_:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(this.content_)),this.getPanes()[this.pane_].appendChild(this.div_),this.addClickHandler_(),this.div_.style.width?this.fixedWidthSet_=!0:0!==this.maxWidth_&&this.div_.offsetWidth>this.maxWidth_?(this.div_.style.width=this.maxWidth_,this.div_.style.overflow="auto",this.fixedWidthSet_=!0):(i=this.getBoxWidths_(),this.div_.style.width=this.div_.offsetWidth-i.left-i.right+"px",this.fixedWidthSet_=!1),this.panBox_(this.disableAutoPan_),!this.enableEventPropagation_){for(this.eventListeners_=[],e=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"],t=0;t<e.length;t++)this.eventListeners_.push(google.maps.event.addDomListener(this.div_,e[t],n));this.eventListeners_.push(google.maps.event.addDomListener(this.div_,"mouseover",function(t){this.style.cursor="default"}))}this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",s),google.maps.event.trigger(this,"domready")}},t.prototype.getCloseBoxImg_=function(){var t="";return""!==this.closeBoxURL_&&(t="<img",t+=" src='"+this.closeBoxURL_+"'",t+=" align=right",t+=" style='",t+=" position: relative;",t+=" cursor: pointer;",t+=" margin: "+this.closeBoxMargin_+";",t+="'>"),t},t.prototype.addClickHandler_=function(){var t;""!==this.closeBoxURL_?(t=this.div_.firstChild,this.closeListener_=google.maps.event.addDomListener(t,"click",this.getCloseClickHandler_())):this.closeListener_=null},t.prototype.getCloseClickHandler_=function(){var t=this;return function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),google.maps.event.trigger(t,"closeclick"),t.close()}},t.prototype.panBox_=function(t){var e,i,o=0,n=0;if(!t&&(e=this.getMap(),e instanceof google.maps.Map)){e.getBounds().contains(this.position_)||e.setCenter(this.position_),i=e.getBounds();var s=e.getDiv(),r=s.offsetWidth,a=s.offsetHeight,l=this.pixelOffset_.width,h=this.pixelOffset_.height,d=this.div_.offsetWidth,c=this.div_.offsetHeight,p=this.infoBoxClearance_.width,_=this.infoBoxClearance_.height,g=this.getProjection().fromLatLngToContainerPixel(this.position_);if(g.x<-l+p?o=g.x+l-p:g.x+d+l+p>r&&(o=g.x+d+l+p-r),this.alignBottom_?g.y<-h+_+c?n=g.y+h-_-c:g.y+h+_>a&&(n=g.y+h+_-a):g.y<-h+_?n=g.y+h-_:g.y+c+h+_>a&&(n=g.y+c+h+_-a),0!==o||0!==n){e.getCenter();e.panBy(o,n)}}},t.prototype.setBoxStyle_=function(){var t,e;if(this.div_){this.div_.className=this.boxClass_,this.div_.style.cssText="",e=this.boxStyle_;for(t in e)e.hasOwnProperty(t)&&(this.div_.style[t]=e[t]);this.div_.style.WebkitTransform="translateZ(0)","undefined"!=typeof this.div_.style.opacity&&""!==this.div_.style.opacity&&(this.div_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+100*this.div_.style.opacity+')"',this.div_.style.filter="alpha(opacity="+100*this.div_.style.opacity+")"),this.div_.style.position="absolute",this.div_.style.visibility="hidden",null!==this.zIndex_&&(this.div_.style.zIndex=this.zIndex_)}},t.prototype.getBoxWidths_=function(){var t,e={top:0,bottom:0,left:0,right:0},i=this.div_;return document.defaultView&&document.defaultView.getComputedStyle?(t=i.ownerDocument.defaultView.getComputedStyle(i,""),t&&(e.top=parseInt(t.borderTopWidth,10)||0,e.bottom=parseInt(t.borderBottomWidth,10)||0,e.left=parseInt(t.borderLeftWidth,10)||0,e.right=parseInt(t.borderRightWidth,10)||0)):document.documentElement.currentStyle&&i.currentStyle&&(e.top=parseInt(i.currentStyle.borderTopWidth,10)||0,e.bottom=parseInt(i.currentStyle.borderBottomWidth,10)||0,e.left=parseInt(i.currentStyle.borderLeftWidth,10)||0,e.right=parseInt(i.currentStyle.borderRightWidth,10)||0),e},t.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},t.prototype.draw=function(){this.createInfoBoxDiv_();var t=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=t.x+this.pixelOffset_.width+"px",this.alignBottom_?this.div_.style.bottom=-(t.y+this.pixelOffset_.height)+"px":this.div_.style.top=t.y+this.pixelOffset_.height+"px",this.isHidden_?this.div_.style.visibility="hidden":this.div_.style.visibility="visible"},t.prototype.setOptions=function(t){"undefined"!=typeof t.boxClass&&(this.boxClass_=t.boxClass,this.setBoxStyle_()),"undefined"!=typeof t.boxStyle&&(this.boxStyle_=t.boxStyle,this.setBoxStyle_()),"undefined"!=typeof t.content&&this.setContent(t.content),"undefined"!=typeof t.disableAutoPan&&(this.disableAutoPan_=t.disableAutoPan),"undefined"!=typeof t.maxWidth&&(this.maxWidth_=t.maxWidth),"undefined"!=typeof t.pixelOffset&&(this.pixelOffset_=t.pixelOffset),"undefined"!=typeof t.alignBottom&&(this.alignBottom_=t.alignBottom),"undefined"!=typeof t.position&&this.setPosition(t.position),"undefined"!=typeof t.zIndex&&this.setZIndex(t.zIndex),"undefined"!=typeof t.closeBoxMargin&&(this.closeBoxMargin_=t.closeBoxMargin),"undefined"!=typeof t.closeBoxURL&&(this.closeBoxURL_=t.closeBoxURL),"undefined"!=typeof t.infoBoxClearance&&(this.infoBoxClearance_=t.infoBoxClearance),"undefined"!=typeof t.isHidden&&(this.isHidden_=t.isHidden),"undefined"!=typeof t.visible&&(this.isHidden_=!t.visible),"undefined"!=typeof t.enableEventPropagation&&(this.enableEventPropagation_=t.enableEventPropagation),this.div_&&this.draw()},t.prototype.setContent=function(t){this.content_=t,this.div_&&(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.fixedWidthSet_||(this.div_.style.width=""),"undefined"==typeof t.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+t:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(t)),this.fixedWidthSet_||(this.div_.style.width=this.div_.offsetWidth+"px","undefined"==typeof t.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+t:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(t))),this.addClickHandler_()),google.maps.event.trigger(this,"content_changed")},t.prototype.setPosition=function(t){this.position_=t,this.div_&&this.draw(),google.maps.event.trigger(this,"position_changed")},t.prototype.setZIndex=function(t){this.zIndex_=t,this.div_&&(this.div_.style.zIndex=t),google.maps.event.trigger(this,"zindex_changed")},t.prototype.setVisible=function(t){this.isHidden_=!t,this.div_&&(this.div_.style.visibility=this.isHidden_?"hidden":"visible")},t.prototype.getContent=function(){return this.content_},t.prototype.getPosition=function(){return this.position_},t.prototype.getZIndex=function(){return this.zIndex_},t.prototype.getVisible=function(){var t;return t="undefined"!=typeof this.getMap()&&null!==this.getMap()&&!this.isHidden_},t.prototype.show=function(){this.isHidden_=!1,this.div_&&(this.div_.style.visibility="visible")},t.prototype.hide=function(){this.isHidden_=!0,this.div_&&(this.div_.style.visibility="hidden")},t.prototype.open=function(t,e){var i=this;e&&(this.position_=e.getPosition(),this.moveListener_=google.maps.event.addListener(e,"position_changed",function(){i.setPosition(this.getPosition())})),this.setMap(t),this.div_&&this.panBox_()},t.prototype.close=function(){var t;if(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.eventListeners_){for(t=0;t<this.eventListeners_.length;t++)google.maps.event.removeListener(this.eventListeners_[t]);this.eventListeners_=null}this.moveListener_&&(google.maps.event.removeListener(this.moveListener_),this.moveListener_=null),this.contextListener_&&(google.maps.event.removeListener(this.contextListener_),this.contextListener_=null),this.setMap(null)},function(i){if(window.google&&google.maps){var o={pan_mode:!1};e.toRad_=function(t){return t*Math.PI/180},e.Store=function(t,e,i,o){this.id_=t,this.location_=e,this.categories_=i,this.props_=o||{},this.v_id=o.vendor_id},e.Store.prototype.setMarker=function(t){this.marker_=t,google.maps.event.trigger(this,"marker_changed",t)},e.Store.prototype.getMarker=function(){return this.marker_},e.Store.prototype.getId=function(){return this.id_},e.Store.prototype.getLocation=function(){return this.location_},e.Store.prototype.hasCategory=function(t){return this.categories_.indexOf(t)!=-1},e.Store.prototype.hasAnyCategory=function(t){if(!t.array_.length)return!0;for(var e=t.asList(),i=0,o=e.length;i<o;i++)if(this.hasCategory(e[i].id_))return!0;return!1},e.Store.prototype.getDetails=function(){return this.props_},e.Store.prototype.getStoreContent=function(){if(!this.content_){var t=window.asl_tmpl_list_item?window.asl_tmpl_list_item:i.templates("#tmpl_list_item");window.asl_tmpl_list_item=t,this.content_=i(t.render({id:this.props_.id,address:this.props_.address,title:this.props_.title,city:this.props_.city,fax:this.props_.fax,phone:this.props_.phone,state:this.props_.state}))}return this.content_},e.Store.prototype.getcontent_=function(t){var e=window.asl_too_tip_tmpl?window.asl_too_tip_tmpl:i.templates("#asl_too_tip");window.asl_too_tip_tmpl=e,t.props_.show_categories=asl_configuration.show_categories,t.props_.URL=asl_configuration.URL;var o=e.render(t.props_);return o},e.Store.prototype.getInfoWindowContent=function(t){var e='<div class="infoWindow" id="style_0">';return e+=this.getcontent_(this),e+="</div>",this.content_=e,this.content_},e.Store.infoPanelCache_={},e.Store.prototype.getInfoPanelItem=function(){var t=this,i=e.Store.infoPanelCache_,o=t.id_;if(!i[o]){var n=t.getStoreContent();i[o]=n[0]}return i[o]},e.Store.prototype.distanceTo=function(t){var i=6371,o=this.getLocation(),n=e.toRad_(o.lat()),s=e.toRad_(o.lng()),r=e.toRad_(t.lat()),a=e.toRad_(t.lng()),l=r-n,h=a-s,d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(n)*Math.cos(r)*Math.sin(h/2)*Math.sin(h/2),c=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),p=i*c;return"MILES"==asl_configuration.distance_unit?.621371*p:p},e.View=function(t,o,n){this.map_=t,this.data_=o,this.settings_=i.extend({updateOnPan:!0,geolocation:!1,features:new e.FeatureSet},n),this.init_(),google.maps.event.trigger(this,"load"),this.set("featureFilter",new e.FeatureSet)},e.View=e.View,e.View.prototype=new google.maps.MVCObject,e.View.prototype.geolocate_=function(){window.navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){},void 0,{maximumAge:6e4,timeout:1e4})},e.View.prototype.init_=function(){this.settings_.geolocation&&this.geolocate_(),this.markerCache_={},this.infoWindow_=new t({disableAutoPan:!1,boxStyle:{width:"250px",margin:"0 0 33px -120px"},alignBottom:!0,closeBoxMargin:"12px 5px -22px 0",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1)});var e=this,i=this.getMap();this.set("updateOnPan",this.settings_.updateOnPan),google.maps.event.addListener(this.infoWindow_,"closeclick",function(){e.highlight(null)}),google.maps.event.addListener(i,"click",function(){e.highlight(null),e.infoWindow_.close()})},e.View.prototype.updateOnPan_changed=function(){this.updateOnPanListener_&&google.maps.event.removeListener(this.updateOnPanListener_);var t=this;if(this.get("updateOnPan")&&this.getMap()){var t=this,e=this.getMap();this.updateOnPanListener_=google.maps.event.addListener(e,"idle",function(){t.showing_direction||t.refreshView()})}},e.View.prototype.addStoreToMap=function(t){var e=this.getMarker(t);t.setMarker(e);var i=this;e.clickListener_=google.maps.event.addListener(e,"click",function(){i.marker_clicked=!0,i.marker_center=e.getPosition(),i.highlight(t,!1)}),e.getMap()!=this.getMap()&&e.setMap(this.getMap())},e.View.prototype.createMarker=function(t){var e=(new google.maps.Size(35,35),asl_configuration.URL+"public/icon/");return e+="default.png",new google.maps.Marker({position:t.getLocation(),icon:new google.maps.MarkerImage(e,null,null,null,null)})},e.View.prototype.getMarker=function(t){var e=this.markerCache_,i=t.id_;return e[i]||(e[i]=this.createMarker(t)),e[i]},e.View.prototype.getInfoWindow=function(t,e){if(!t)return this.infoWindow_;var o=i(t.getInfoWindowContent(e));return this.infoWindow_.setContent(o[0]),this.infoWindow_},e.View.prototype.getViewFeatures=function(){return this.settings_.features},e.View.prototype.getFeatureById=function(t){if(!this.featureById_){this.featureById_={};for(var e,i=0;e=this.settings_.features[i];i++)this.featureById_[e.id_]=e}return this.featureById_[t]},e.View.prototype.featureFilter_changed=function(){google.maps.event.trigger(this,"featureFilter_changed",this.get("featureFilter")),this.get("stores")&&this.clearMarkers()},e.View.prototype.clearMarkers=function(){for(var t in this.markerCache_){this.markerCache_[t].setMap(null);var e=this.markerCache_[t].clickListener_;e&&google.maps.event.removeListener(e)}},e.View.prototype.refreshView=function(t){var e=this;this.data_.getStores(this.getMap().getBounds(),this.get("featureFilter"),function(t){var i=e.get("stores");if(i)for(var o=0,n=i.length;o<n;o++)google.maps.event.removeListener(i[o].getMarker().clickListener_);var s=[];for(var r in t)t.hasOwnProperty(r)&&s.push(t[r]);e.set("stores",s)},t)},e.View.prototype.stores_changed=function(){for(var t,i=this.get("stores"),o=[],n=0;t=i[n];n++)this.addStoreToMap(t),o.push(t.marker_);"1"==asl_configuration.cluster&&(e.marker_clusters.clearMarkers(),e.marker_clusters.addMarkers(o))},e.View.prototype.getMap=function(){return this.map_},e.View.prototype.highlight=function(t,e){var i=null;if(t){var o=this.get("stores");if(i=this.getInfoWindow(t,o),t.getMarker()){var n=this;t.getMarker();i.open(n.getMap(),t.getMarker())}else i.setPosition(t.getLocation()),i.open(this.getMap());this.getMap().setZoom(parseInt(13)),this.getMap().getStreetView().getVisible()&&this.getMap().getStreetView().setPosition(t.getLocation())}else this.getInfoWindow().close();this.set("selectedStore",t)},e.View.prototype.selectedStore_changed=function(){google.maps.event.trigger(this,"selectedStore_changed",this.get("selectedStore"))},e.ViewOptions=function(){},e.ViewOptions.prototype.updateOnPan,e.ViewOptions.prototype.geolocation,e.ViewOptions.prototype.features,e.ViewOptions.prototype.markerIcon,e.Feature=function(t,e,i){this.id_=t,this.name_=e,this.img_=i},e.Feature=e.Feature,e.Feature.prototype.getId=function(){return this.id_},e.Feature.prototype.getDisplayName=function(){return this.name_},e.Feature.prototype.toString=function(){return this.getDisplayName()},e.FeatureSet=function(t){this.array_=[],this.hash_={};for(var e,i=0;e=arguments[i];i++)this.add(e)},e.FeatureSet=e.FeatureSet,e.FeatureSet.prototype.toggle=function(t){this.hash_[t.id_]?this.remove(t):this.add(t)},e.FeatureSet.prototype.add=function(t){t&&(this.array_.push(t),this.hash_[t.id_]=1)},e.FeatureSet.prototype.remove=function(t){var e=t.id_;this.hash_[e]&&(delete this.hash_[e],this.array_=this.array_.filter(function(t){return t&&t.id_!=e}))},e.FeatureSet.prototype.asList=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++){var o=this.array_[e];null!==o&&t.push(o)}return t},e.FeatureSet.NONE=new e.FeatureSet,e.Panel=function(t,e){this.el_=i(t),this.el_.addClass("asl_locator-panel"),this.settings_=i.extend({locationSearch:!0,locationSearchLabel:"Enter Location/ZipCode: ",featureFilter:!0,directions:!0,view:null},e),this.directionsRenderer_=new google.maps.DirectionsRenderer({draggable:!0}),this.directionsService_=new google.maps.DirectionsService,this.init_()},e.Panel=e.Panel,e.Panel.prototype=new google.maps.MVCObject,e.Panel.prototype.init_=function(){var t=this;this.itemCache_={},this.settings_.view&&this.set("view",this.settings_.view),this.filter_=i(".asl-p-cont .header-search");var o=t.get("view").getMap();window.asl_map=o,"1"==asl_configuration.cluster&&(e.marker_clusters=new MarkerClusterer(o,[],{maxZoom:7,gridSize:40,imagePath:asl_configuration.URL+"public/icon/m"})),this.settings_.locationSearch&&(this.locationSearch_=this.filter_,"undefined"!=typeof google.maps.places?"1"!=asl_configuration.search_type&&this.initAutocomplete_():this.filter_.submit(function(){t.searchPosition(i("input",t.locationSearch_).val())}),this.filter_.submit(function(){return!1}),google.maps.event.addListener(this,"geocode",function(e){if(t.searchPositionTimeout_&&window.clearTimeout(t.searchPositionTimeout_),!e.geometry)return void t.searchPosition(e.name);this.directionsFrom_=e.geometry.location,t.directionsVisible_&&t.renderDirections_();var i=t.get("view");i.highlight(null);var o=i.getMap();e.geometry.viewport?o.fitBounds(e.geometry.viewport):(o.setCenter(e.geometry.location),o.setZoom(parseInt(13))),i.refreshView(),t.listenForStoresUpdate_()})),this.storeList_=i(".asl-p-cont #panel .panel-inner"),this.directionsPanel_=i(".asl-p-cont #agile-modal-direction");var n=this.directionsPanel_.find(".frm-place");n.val(""),t.dest_coords&&(r.directionsFrom_=t.dest_coords);var s=this.directionsPanel_.find(".frm-place")[0];this.input_search=new google.maps.places.Autocomplete(s);var r=this;google.maps.event.addListener(this.input_search,"place_changed",function(){r.directionsFrom_=this.getPlace().geometry.location}),this.directionsPanel_.find(".directions-to").attr("readonly","readonly"),this.directionsVisible_=!1,this.directionsPanel_.find(".btn-submit").click(function(e){return t.dest_coords&&"Current Location"==n.val()&&(t.directionsFrom_=t.dest_coords||null),t.renderDirections_(),!1}),t.distance_type=google.maps.UnitSystem.IMPERIAL,t.directionsPanel_.find("input[name=dist-type]").change(function(){t.distance_type=1==this.value?google.maps.UnitSystem.IMPERIAL:google.maps.UnitSystem.METRIC}),this.el_.find(".directions-cont .close").click(function(){t.hideDirections(),i(".asl-p-cont .count-row").removeClass("hide"),i(".asl-p-cont #filter-options").removeClass("hide")}),this.directionsPanel_.find(".close-directions").click(function(){t.hideDirections(),i(".asl-p-cont .count-row").removeClass("hide"),i(".asl-p-cont #filter-options").removeClass("hide")})},e.Panel.prototype.toggleFeatureFilter_=function(t){var e=this.get("featureFilter");e.toggle(t),this.set("featureFilter",e)},e.geocoder_=new google.maps.Geocoder,e.Panel.prototype.listenForStoresUpdate_=function(){var t=this,e=this.get("view");this.storesChangedListener_&&google.maps.event.removeListener(this.storesChangedListener_),this.storesChangedListener_=google.maps.event.addListenerOnce(e,"stores_changed",function(){t.set("stores",e.get("stores"))})},e.Panel.prototype.searchPosition=function(t){var i=this,o={address:t,bounds:this.get("view").getMap().getBounds()};e.geocoder_.geocode(o,function(t,e){e==google.maps.GeocoderStatus.OK&&google.maps.event.trigger(i,"geocode",t[0])})},e.Panel.prototype.setView=function(t){this.set("view",t)},e.Panel.prototype.view_changed=function(){var t=this,e=this.get("view");this.bindTo("selectedStore",e),window.test_panel=t,this.geolocationListener_&&google.maps.event.removeListener(this.geolocationListener_),this.zoomListener_&&google.maps.event.removeListener(this.zoomListener_),this.idleListener_&&google.maps.event.removeListener(this.idleListener_);var i=(e.getMap().getCenter(),function(){o.pan_mode||t.listenForStoresUpdate_()});this.geolocationListener_=google.maps.event.addListener(e,"load",i),this.zoomListener_=google.maps.event.addListener(e.getMap(),"zoom_changed",i),this.idleListener_=google.maps.event.addListener(e.getMap(),"idle",function(){return t.idle_(e.getMap())}),i(),this.bindTo("featureFilter",e),this.autoComplete_&&this.autoComplete_.bindTo("bounds",e.getMap())},e.Panel.prototype.initAutocomplete_=function(){var t=this,e=i(".asl-p-cont #auto-complete-search")[0],o={};this.autoComplete_=new google.maps.places.Autocomplete(e,o),this.get("view")&&this.autoComplete_.bindTo("bounds",this.get("view").getMap()),google.maps.event.addListener(this.autoComplete_,"place_changed",function(){var e=this.getPlace();google.maps.event.trigger(t,"geocode",e)})},e.Panel.prototype.idle_=function(t){this.center_?t.getBounds().contains(this.center_)||(this.center_=t.getCenter(),this.listenForStoresUpdate_()):this.center_=t.getCenter()},e.Panel.prototype.stores_changed=function(){if(this.get("stores")){var t=this,e=this.get("view");if(!e.showing_direction){e.is_updated=!0;var o=e&&e.getMap().getBounds(),n=e.get("stores"),s=this.get("selectedStore");this.storeList_.empty(),n.length?o&&!o.contains(n[0].getLocation())?i(".asl-p-cont .Num_of_store .count-result").html(n.length):i(".asl-p-cont .Num_of_store .count-result").html(n.length):(i(".asl-p-cont .Num_of_store .count-result").html("0"),t.storeList_.html('<div class="asl-overlay-on-item" id="asl-no-item-found"><div class="white"></div><h1 class="h1">No Store Found</h1></div>'));for(var r=function(t){i(t.target);"A"!=t.target.tagName&&(e.noRefreshList=!0,e.highlight(this.store,!0))},a=0,l=Math.min(1e3,n.length);a<l;a++){var h=n[a].getInfoPanelItem();h.store=n[a],s&&n[a].id_==s.id_&&i(h).addClass("highlighted"),h.clickHandler_||(h.clickHandler_=google.maps.event.addDomListener(h,"click",r)),i(h).find(".s-direction").click(function(e){var o=i(this).data("_store");t.directionsTo_=o,t.showDirections(o)}).data("_store",n[a]),t.storeList_.append(h)}}}},e.Panel.prototype.selectedStore_changed=function(){i(".highlighted",this.storeList_).removeClass("highlighted");var t=this,e=this.get("selectedStore");if(e){this.directionsTo_=e,this.storeList_.find("#store-"+e.id_).addClass("highlighted"),this.settings_.directions&&this.directionsPanel_.find(".directions-to").val(e.getDetails().title);var o=t.get("view").getInfoWindow().getContent(),n=i("<a/>").text(asl_configuration.words.direction).attr("href","javascript:void(0)").addClass("action").addClass("directions"),s=i("<a/>").text(asl_configuration.words.zoom).attr("href","javascript:void(0)").addClass("action").addClass("zoomhere"),r=e.props_.website;if(n.click(function(){return t.showDirections(),!1}),s.click(function(){t.get("view").getMap().setOptions({center:e.getLocation(),zoom:16})}),i(o).find(".asl-buttons").append(n).append(s),r){var a=i("<a/>").attr("target","_Blank").text(asl_configuration.words.detail).attr("href",r).addClass("action");i(o).find(".asl-buttons").append(a)}}},e.Panel.prototype.hideDirections=function(){this.directionsVisible_=!1,this.directionsPanel_.removeClass("in"),this.el_.find(".directions-cont").addClass("hide"),this.storeList_.fadeIn(),this.directionsRenderer_.setMap(null);var t=this.get("view");t.showing_direction=!1},e.Panel.prototype.showDirections=function(t){var e=this.get("selectedStore")||t;e&&(this.directionsPanel_.find(".frm-place").val(this.dest_coords?"Current Location":""),this.directionsPanel_.find(".directions-to").val(e.getDetails().title),this.directionsPanel_.addClass("in"),this.renderDirections_(),this.directionsVisible_=!0)},e.Panel.prototype.renderDirections_=function(){var t=this;if(this.directionsFrom_&&this.directionsTo_){this.el_.find("#map-loading").show(),this.el_.find(".directions-cont").removeClass("hide"),this.storeList_.fadeOut(),t.directionsPanel_.removeClass("in");var e=this.el_.find(".rendered-directions").empty();this.directionsService_.route({origin:this.directionsFrom_,destination:this.directionsTo_.getLocation(),travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:t.distance_type},function(o,n){if(t.el_.find("#map-loading").hide(),n==google.maps.DirectionsStatus.OK){i(".asl-p-cont .count-row").addClass("hide"),i(".asl-p-cont #filter-options").addClass("hide");var s=t.get("view");s.showing_direction=!0;var r=t.directionsRenderer_;r.setPanel(e[0]),r.setMap(t.get("view").getMap()),r.setDirections(o)}}),this.directionsFrom_=null}},e.Panel.prototype.featureFilter_changed=function(){this.listenForStoresUpdate_()},e.PanelOptions=function(){},e.prototype.locationSearch,e.PanelOptions.prototype.locationSearchLabel,e.PanelOptions.prototype.featureFilter,e.PanelOptions.prototype.directions,e.PanelOptions.prototype.view}}(asl_jQuery),function(t,i){var o=null,n={config:{},helper:{}};if(window.asl_engine=n,window.asl_configuration){asl_configuration.scroll_wheel="1"==asl_configuration.scroll_wheel;var s=asl_configuration.default_lat?parseFloat(asl_configuration.default_lat):39.9217698526,r=asl_configuration.default_lng?parseFloat(asl_configuration.default_lng):-75.5718432;new Date;asl_configuration.show_opened=!0,t("#asl-dist-unit").html(asl_configuration.distance_unit),n.helper.asl_leadzero=function(t){return t>9?""+t:"0"+t},n.helper.asl_timeConvert=function(t){var e=t,i=Number(e.match(/^(\d+)/)[1]),o=Number(e.match(/:(\d+)/)[1]),n=e.match(/\s(.*)$/);return n&&n[1]&&(n=n[1],"PM"==n&&i<12&&(i+=12),"AM"==n&&12==i&&(i-=12)),i+o/100},n.helper.between=function(t,e,i){return t>e&&t<i},n.helper.implode=function(t,e){for(var i=[],o=0,n=t.length;o<n;o++)t[o]&&i.push(t[o]);return i.join(e)},n.helper.toObject_=function(t,e){for(var i={},o=0,n=e.length;o<n;o++)i[t[o]]=e[o];return i},n.helper.distanceCalc=function(t){var i=6371,o=this.getLocation(),n=e.toRad_(o.lat()),s=e.toRad_(o.lng()),r=e.toRad_(t.lat()),a=e.toRad_(t.lng()),l=r-n,h=a-s,d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(n)*Math.cos(r)*Math.sin(h/2)*Math.sin(h/2),c=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d));return i*c},n.dataSource=function(){this.stores_=[],this.remote_url=ASL_REMOTE.ajax_url};var a=!1,l=null,h=null;n.dataSource.prototype.fetch_remote_data=function(i){var n=this;t(".asl-p-cont .asl-overlay").show();var s={action:"asl_load_stores",nonce:ASL_REMOTE.nonce};t.ajax({url:ASL_REMOTE.ajax_url,data:s,type:"GET",dataType:"json",success:function(s){n.stores_=n.parseData(s);var r=n.stores_,d=r[0]?r[0].props_.country:null;n.countries=!1;for(var c=0;c<r.length;c++)if(d!=r[c].props_.country){n.countries=!0;break}a||(a=!0,l=new e.View(o,n,{geolocation:!1,features:n.getDSFeatures()}),h=new e.Panel(document.getElementById("panel"),{view:l}),l._panel=h,t(".asl-p-cont .glyphicon-screenshot").bind("click",function(t){l.geolocate_()})),l.refreshView(!0),t(".asl-p-cont .asl-overlay").hide(),i&&o.panTo(i)},dataType:"json"})},n.dataSource.prototype.load_locator=function(){var t=this,i={center:new google.maps.LatLng(s,r),zoom:parseInt(asl_configuration.zoom),scrollwheel:asl_configuration.scroll_wheel,mapTypeId:asl_configuration.map_type};o=new google.maps.Map(document.getElementById("map-canvas"),i);for(var n in asl_categories){var a=asl_categories[n];t.FEATURES_.add(new e.Feature(a.id,a.name,a.icon))}t.fetch_remote_data()},n.dataSource.prototype.FEATURES_=new e.FeatureSet,n.dataSource.prototype.getDSFeatures=function(){return this.FEATURES_},n.dataSource.prototype.parseData=function(i){var o=[],s=asl_categories;asl_categories={};var r=Object.keys(s);for(var a in r)"object"==typeof s[r[a]]&&(asl_categories[String(r[a])]=s[r[a]],asl_categories[r[a]].len=0);for(var l=0;l<i.length;l++){var h=i[l];h.lat=parseFloat(h.lat),h.lng=parseFloat(h.lng);var d=new google.maps.LatLng(h.lat,h.lng),c=n.helper.implode([h.city,h.state,h.postal_code],", "),p=[h.street,c];h.address=n.helper.implode(p," <br> ");var _=h.categories?h.categories.split(","):[],g=[];if(asl_configuration.show_categories){var u=[];for(var f in _){var v=_[f].toString();asl_categories[v]?(g.push(asl_categories[v]),u.push(asl_categories[v].name)):delete _[f]}h.c_names=n.helper.implode(u,", "),h.categories=g}h.city=t.trim(h.city).replace(/[^a-z0-9\s]/gi,""),h.country=t.trim(h.country),h.description_2=null,h.marker_id=h.marker_id?h.marker_id.toString():"",h.open=!0;var m=new e.Store(h.id,d,_,h);o.push(m)}return o};var d=new n.dataSource;d.getStores=function(t,e,i,o){for(var n,s=[],r=0;n=this.stores_[r];r++)n.hasAnyCategory(e)&&s.push(n);i(s)},google.maps.event.addDomListener(window,"load",function(){d.load_locator()})}}(asl_jQuery,asl_underscore)});