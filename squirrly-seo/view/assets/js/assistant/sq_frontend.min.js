(function($){$.fn.sq_frontend=function(options){var $this=this;var settings=$.extend({positions:[],minimize_height:134,maximize_height:100,top:25,bottom:0},options);$.sq_fields=$.extend({wp_form:$(".metabox-location-normal").length>0?$(".metabox-location-normal"):$("#side-sortables"),sq_box_close:$.sq_config.div.find(".sq_box_close"),sq_box_minimize:$.sq_config.div.find(".sq_box_minimize"),sq_box_maximize:$.sq_config.div.find(".sq_box_maximize"),sq_button_squirrly:$(".edit__PinnedPluginIcon-hNdeXr")},$.sq_fields);$.expr.filters.slaoffscreen=function(el){var rect=el.getBoundingClientRect();return rect.x+rect.width<0||rect.y+rect.height<0||(rect.x>window.innerWidth||rect.y>window.innerHeight)};$this.one("seo.loaded",function(){SQ_DEBUG&&console.log("sq_frontend seo.loaded");if($.sq_config.referer==="frontend"&&!$.sq_isFrontend()){var sq_header=$.sq_fields.sq_box.find(".sq_header");$.sq_fields.sq_box.html('<div style="font-size: 13px; padding: 2px;  margin: 0;  line-height: 19px; text-align: center;">'+$.sq_config.__frontend_optimized+"</div>");$.sq_fields.sq_box.prepend(sq_header);$.sq_fields.sq_box.find(".sq_box_maximize").hide();$.sq_fields.sq_box.find(".sq_box_close").on("click",function(){$.sq_config.div.hide();$.sq_setCookie("sq_sla","off")});$.sq_config.div.show();setTimeout(function(){$.sq_config.div.hide()},5e3)}if($.sq_isFrontend()){var dragposition="";$.sq_config.div.find("#sq_options").remove();$.sq_editor.createEditorButton("components-squirrly-icon");$.sq_config.div.addClass("sq_sticky");$.sq_config.div.addClass("minimized");$.sq_fields.sq_box_minimize.hide();$.sq_fields.sq_box_close.show();$.sq_fields.sq_box_maximize.show();$.sq_config.div.show();var positions=JSON.parse(localStorage.positions||"{}");$(function(){$.each(positions,function(id,pos){$.sq_config.div.css(pos)});$.sq_config.div.css("height",settings.minimize_height);$.sq_config.div.css("top","auto");if($.fn.draggable){$.sq_config.div.draggable({containment:"body",handle:".sq_header",scroll:true,axis:"x",stop:function(event,ui){positions[this.id]=ui.position;localStorage.positions=JSON.stringify(positions)}})}});$.sq_fields.sq_box_minimize.on("click",function(e){e.stopPropagation();$.sq_config.div.css("height",settings.minimize_height+"px");$.sq_config.div.css("bottom",settings.bottom+"px");$.sq_config.div.css("top","auto");$.sq_config.div.addClass("minimized");$.sq_fields.sq_box_minimize.hide();$.sq_fields.sq_box_maximize.show()});$.sq_fields.sq_box_close.on("click",function(){$.sq_config.div.hide();$.sq_setCookie("sq_sla","off");$(".components-squirrly-icon").show()});$.sq_fields.sq_box_maximize.on("click",function(){$.sq_config.div.show();if($.sq_config.div.hasClass("minimized")){$.sq_config.div.css("top",settings.top+"px");$.sq_config.div.css("height","auto");$.sq_config.div.css("bottom",0);$.sq_config.div.removeClass("minimized");$.sq_fields.sq_box_minimize.show();$.sq_fields.sq_box_maximize.hide()}});$(".editor-writing-flow").css("height","auto");$(window).resize(function(){if($.sq_config.div.is(":slaoffscreen")){$.sq_config.div.css("left","auto");$.sq_config.div.css("right","0px")}});$(".components-squirrly-icon").on("click",function(){$.sq_fields.sq_box_maximize.trigger("click");$.sq_setCookie("sq_sla","on");$(".components-squirrly-icon").hide()});$this.one("seo.frontend.content_loaded",function(){$this.sq_listenBuilderChange()});$this.sq_VisualBuilder()}});if($.sq_config.div.is(":slaoffscreen")){$.sq_config.div.css("left","auto");$.sq_config.div.css("right","0px")}return $this};$.fn.sq_listenBuilderChange=function(){var $this=this;if(!$.sq_blockseo){return}$this.on("seo.frontend.editor_loaded seo.frontend.new_changes",function(){SQ_DEBUG&&console.log("seo.frontend.new_changes");var ed=$.sq_editor.getFrontendEditor();if(ed){if(ed.getPageTitle()!==""){$.sq_fields.wp_input_title.val(ed.getPageTitle())}$.sq_blockseo.trigger("seo.refresh")}SQ_DEBUG&&console.log("seo.frontend.new_changes DONE")});$.sq_blockseo.on("seo.refresh_click",function(){$this.checkPostAjax()});$this.on("seo.frontend.page_saved",function(){SQ_DEBUG&&console.log("seo.frontend.page_saved");var ed=$.sq_editor.getFrontendEditor();if(ed){if($.sq_blockbriefcase){$.sq_blockbriefcase.trigger("briefcase.save")}var $sq_seo=[];$this.find('input[name="sq_seo[]"]').each(function(){$sq_seo.push(this.value)});$.post(sqQuery.ajaxurl,{action:"sq_ajax_save_post",post_id:$.sq_config.postID,sq_keyword:$.sq_config.keyword,referer:"frontend",sq_seo:$sq_seo,sq_nonce:sqQuery.nonce})}SQ_DEBUG&&console.log("seo.frontend.page_saved DONE")});$this.checkPostAjax=function(){return $.post(sqQuery.ajaxurl,{action:"sq_ajax_get_post",post_id:$.sq_config.postID,sq_nonce:sqQuery.nonce}).done(function(data){if(typeof data.url!=="undefined"){if(!$.sq_config.div.find("#new-post-slug").length){$.sq_config.div.append('<input type="hidden" id="new-post-slug" />')}$("#new-post-slug").val(data.url)}if(typeof data.post_title!=="undefined"){$.sq_fields.wp_input_title.val(data.post_title)}$this.trigger("seo.frontend.new_changes")})};if(!$.sq_config.div.find("#sq_post_title").length){$.sq_config.div.append('<input type="hidden" id="sq_post_title" />');$.sq_fields.wp_input_title=$("#sq_post_title");$this.checkPostAjax()}};$.fn.sq_VisualBuilder=function(){var $this=this;if(typeof window.sq_editor!=="undefined"){return window.sq_editor}var builderExists=false;var builderInUse="";var $builderContents=null;var $lastNumberOfNodes=0;var $currentNumberOfNodes=0;var $elementLoadingTime=null;var buildersInfo={elementor:{enabled:true,name:"elementor",hasIframe:true,iframeSelector:"#elementor-preview-iframe",parrentDiv:"#page"},WPBakery:{enabled:false,name:"WPBakery",hasIframe:true,iframeSelector:"#vc_inline-frame",parrentDiv:"#vc_editor"},beaver:{enabled:false,name:"beaver",hasIframe:false,iframeSelector:"#vc_inline-frame",parrentDiv:".fl-builder"},liveComposer:{enabled:false,name:"liveComposer",hasIframe:true,iframeSelector:"#page-builder-frame",parrentDiv:".fl-builder"},divi:{enabled:false,name:"diviBuilder",hasIframe:true,iframeSelector:"#et-fb-app-frame",parrentDiv:".et_divi_builder"},oxygen:{enabled:true,name:"oxygen",hasIframe:true,iframeSelector:"#ct-artificial-viewport",parrentDiv:"#oxygen-ui"}};var pageData={url:"",title:"",content:"",h1:"",headline:"",hasMultipleH1:false,images:""};var builderSelectorsSettings={wrapper:"",preview:"",sections:"",h1:"",container:"",containerWidget:"",containerWidgetImages:"",saveButton:""};var currentNumberOfNodes=null;$this.init=function(){SQ_DEBUG&&console.log("checkBuilderExists");$this.checkBuilderExists();if($this.getBuilderExists()){$this.parseBuilders()}};$this.parseBuilders=function(){SQ_DEBUG&&console.log("Check parseBuilders "+$this.getBuilderName());switch($this.getBuilderName()){case"elementor":SQ_DEBUG&&console.log("Found "+$this.getBuilderName()+" builder");$this.parseElementor();break;case"oxygen":SQ_DEBUG&&console.log("Found "+$this.getBuilderName()+" builder");$this.parseOxygen();break}};$this.checkBuilderExists=function(){SQ_DEBUG&&console.log("Looking for builders");$.each(Object.values(buildersInfo),function(index,builder){SQ_DEBUG&&console.log("Checking for: "+builder.name+" builder");if(builder.enabled===false){return}if(builder.hasIframe){if($this.elementExists(builder.iframeSelector)){SQ_DEBUG&&console.log("Found: "+builder.iframeSelector+" iframe");$(builder.iframeSelector).load(function(){SQ_DEBUG&&console.log("Loaded iframeSelector: "+builder.iframeSelector+" from builder "+builder.name);$this.setBuilderExists(builder.name);$builderContents=$(builder.iframeSelector).contents()[0];$this.parseBuilders()});$(builder.iframeSelector).ready(function(){SQ_DEBUG&&console.log("Ready iframeSelector: "+builder.iframeSelector+" from builder "+builder.name);$this.setBuilderExists(builder.name);$builderContents=$(builder.iframeSelector).contents()[0];$this.parseBuilders()});return false}}else if($this.elementExists(builder.parrentDiv)){$builderContents=$(builder.parrentDiv).contents();$this.setBuilderExists(builder.name);return false}})};$this.elementExists=function(element,where){var $whereToLook;if(typeof where==="undefined"){$whereToLook=$(document)}else{$whereToLook=$(where)}$element=$whereToLook.find(element);if(typeof $element!=="undefined"&&$element.length>0){return $element}return false};$this.getBuilderInfo=function(builderName){return buildersInfo[builderName]};$this.waitForElementToDisplay=function(selector,where,time,callback){if($elementLoadingTime){clearTimeout($elementLoadingTime)}if($element=$this.elementExists(selector,where)){callback()}else{$elementLoadingTime=setTimeout(function(){console.log("Waiting for: "+selector);$this.waitForElementToDisplay(selector,where,time,callback)},time)}};$this.parseElementor=function(){SQ_DEBUG&&console.log("Start parsing "+$this.getBuilderName());builderSelectorsSettings={wrapper:["#elementor-editor-wrapper"],preview:["#elementor-preview-iframe"],sections:["section.elementor-element"],title:["h1.entry-title","h1.elementor-heading-title"],header:["h2.entry-title","h2.elementor-heading-title","h3.entry-title","h3.elementor-heading-title","h4.entry-title","h4.elementor-heading-title"],container:[".entry-content",".elementor-inner",".elementor-container"],containerWidget:"[data-element_type='widget'] .elementor-widget-container",containerWidgetImages:[".wp-block-image",".elementor-image",".featured-media-inner"],saveButton:"#elementor-panel-saver-button-publish",draftButton:"#elementor-panel-footer-sub-menu-item-save-draft"};$.each(builderSelectorsSettings.title,function(index,value){if($this.elementExists(value,$builderContents)){$this.setPageTitle($($builderContents).find(value+":first").text())}});$.each(builderSelectorsSettings.header,function(index,value){if($this.elementExists(value,$builderContents)){$this.setPageHeadline($($builderContents).find(value+":first").text())}});$.each(builderSelectorsSettings.container,function(index,value){$this.waitForElementToDisplay(value,$builderContents,$.sq_config.delay_seo,function(){var $elementorWidgets=$($builderContents).find(builderSelectorsSettings.containerWidget);$currentNumberOfNodes=$elementorWidgets.length;var textContainerToConcat="";var textContainerImagesToConcat="";$.each($elementorWidgets,function(){var $element=$(this).clone();$(builderSelectorsSettings.title).each(function(index,val){$element.find(val).remove()});if($.isFunction($element.html)){textContainerToConcat+=$element.html()}else if(typeof $element.context!="undefined"){textContainerToConcat+=$element.context.innerHTML}$.each(builderSelectorsSettings.containerWidgetImages,function(index,value){var $imagesContainers=$element.find(value);if($imagesContainers.length>0){$.each($imagesContainers,function(){if($.isFunction($(this).html)){textContainerImagesToConcat+=$(this).html()}else if(typeof $(this).context!="undefined"){textContainerImagesToConcat+=$(this).context.innerHTML}});return false}})});$this.setPageContent(textContainerToConcat);$this.setPageImages(textContainerImagesToConcat);$this.trigger("seo.frontend.content_loaded")})});$.each(builderSelectorsSettings.preview,function(index,value){$this.waitForElementToDisplay(value,$(document),$.sq_config.delay_seo,function(){$this.setPageURL($(value).attr("src").split("?")[0]);$this.trigger("seo.frontend.preview_loaded")})});$.each(builderSelectorsSettings.wrapper,function(index,value){$this.waitForElementToDisplay(value,$(document),$.sq_config.delay_seo,function(){$this.trigger("seo.frontend.wrapper_loaded")})})};$this.parseOxygen=function(){SQ_DEBUG&&console.log("Start parsing "+$this.getBuilderName());builderSelectorsSettings={wrapper:["#ct-builder"],preview:["#ct-artificial-viewport"],sections:["section.elementor-element"],title:["h1.ct_headline","h1.bnb-heading-one"],header:["div.bnb-subheading"],container:[".ct-component",".ct-div-block"],containerWidget:".ct-inner-wrap",containerWidgetImages:[".ct-image"],saveButton:".oxygen-save-button",draftButton:".oxygen-save-button"};$.each(builderSelectorsSettings.title,function(index,value){if($this.elementExists(value,$builderContents)){$this.setPageTitle($($builderContents).find(value+":first").text())}});$.each(builderSelectorsSettings.header,function(index,value){if($this.elementExists(value,$builderContents)){$this.setPageHeadline($($builderContents).find(value+":first").text())}});$.each(builderSelectorsSettings.container,function(index,value){$this.waitForElementToDisplay(value,$builderContents,$.sq_config.delay_seo,function(){var $elementorWidgets=$($builderContents).find(builderSelectorsSettings.containerWidget);$currentNumberOfNodes=$elementorWidgets.length;var textContainerToConcat="";var textContainerImagesToConcat="";$.each($elementorWidgets,function(){var $element=$(this).clone();$(builderSelectorsSettings.title).each(function(index,val){$element.find(val).remove()});if($.isFunction($element.html)){textContainerToConcat+=$element.html()}else if(typeof $element.context!="undefined"){textContainerToConcat+=$element.context.innerHTML}$.each(builderSelectorsSettings.containerWidgetImages,function(index,value){var $imagesContainers=$element.find(value);if($imagesContainers.length>0){$.each($imagesContainers,function(){if($.isFunction($(this).html)){textContainerImagesToConcat+=$(this).html()}else if(typeof $(this).context!="undefined"){textContainerImagesToConcat+=$(this).context.innerHTML}});return false}})});$this.setPageContent(textContainerToConcat);$this.setPageImages(textContainerImagesToConcat);$this.trigger("seo.frontend.content_loaded")})});$.each(builderSelectorsSettings.preview,function(index,value){$this.waitForElementToDisplay(value,$(document),$.sq_config.delay_seo,function(){$this.setPageURL($(value).attr("src").split("?")[0]);$this.trigger("seo.frontend.preview_loaded")})});$.each(builderSelectorsSettings.wrapper,function(index,value){$this.waitForElementToDisplay(value,$(document),$.sq_config.delay_seo,function(){$this.trigger("seo.frontend.wrapper_loaded")})})};$this.setBuilderExists=function(builderName){builderExists=true;builderInUse=builderName};$this.getBuilderExists=function(){return builderExists};$this.getBuilderName=function(){return builderInUse};$this.getIframeContainer=function(){if(builderSelectorsSettings.preview.length>0){return $(builderSelectorsSettings.preview[0]).contents().find("body")}return false};$this.getPageData=function(){return pageData};$this.getPageURL=function(){return pageData.url};$this.getPageTitle=function(){return pageData.title};$this.getMultipleH1=function(){return pageData.hasMultipleH1};$this.getH1=function(){return pageData.h1};$this.getPageContent=function(){return pageData.content};$this.getPageImages=function(){return pageData.images};$this.getPageHeadline=function(){return pageData.headline};$this.setPageURL=function(url){pageData.url=url};$this.setPageTitle=function(title){pageData.title=title};$this.setH1=function(h1Text){pageData.h1=h1Text};$this.setPageHeadline=function(headline){pageData.headline=headline};$this.setMultipleH1=function(flag){pageData.hasMultipleH1=flag};$this.setPageContent=function(content){pageData.content=content};$this.setPageImages=function(images){pageData.images=images};$this.triggerPageHasChanges=function(){SQ_DEBUG&&console.log("triggerPageHasChanges");$this.trigger("seo.frontend.refresh");$this.trigger("seo.frontend.new_changes")};$this.triggerButtonSaveClicked=function(){SQ_DEBUG&&console.log("triggerButtonSaveClicked");$this.trigger("seo.frontend.refresh");$this.trigger("seo.frontend.page_saved")};$this.on("seo.frontend.refresh",function(){$this.parseBuilders()});$(document).on("click",builderSelectorsSettings.saveButton,function(){$this.triggerButtonSaveClicked()});$(document).on("click",builderSelectorsSettings.draftButton,function(){$this.triggerButtonSaveClicked()});setInterval(function(){$this.trigger("seo.frontend.refresh");SQ_DEBUG&&console.log("Check Blocks number: "+$lastNumberOfNodes+" = "+$currentNumberOfNodes);if($lastNumberOfNodes!==$currentNumberOfNodes){$lastNumberOfNodes=$currentNumberOfNodes;$this.triggerPageHasChanges()}},1e3);$.sq_blockseo.on("seo.task_loaded",function(){$(".sq_tasks").find("#sq_alt").remove()});$this.init();window.sq_editor=$this;$this.trigger("seo.frontend.editor_loaded");return $this}})(jQuery);